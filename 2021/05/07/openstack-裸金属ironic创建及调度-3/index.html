<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>openstack-裸金属ironic创建及调度-3 | Hexo</title>
  <meta name="description" content="云盘支持When user starts bare metal instance with Cinder volume, Nova orchestrates the communication with Cinder and Ironic. The work flow of the boot process is as follows:  (Preparation) Administrator r">
<meta property="og:type" content="article">
<meta property="og:title" content="openstack-裸金属ironic创建及调度-3">
<meta property="og:url" content="https://blog.kubestack.cn/2021/05/07/openstack-%E8%A3%B8%E9%87%91%E5%B1%9Eironic%E5%88%9B%E5%BB%BA%E5%8F%8A%E8%B0%83%E5%BA%A6-3/index.html">
<meta property="og:site_name" content="小白技术博客">
<meta property="og:description" content="云盘支持When user starts bare metal instance with Cinder volume, Nova orchestrates the communication with Cinder and Ironic. The work flow of the boot process is as follows:  (Preparation) Administrator r">
<meta property="og:locale">
<meta property="article:published_time" content="2021-05-07T04:04:08.000Z">
<meta property="article:modified_time" content="2021-08-16T08:25:23.589Z">
<meta property="article:author" content="Tonyzhang1989">
<meta property="article:tag" content="openstack">
<meta name="twitter:card" content="summary">
  <!-- Canonical links -->
  <link rel="canonical" href="https://blog.kubestack.cn/2021/05/07/openstack-%E8%A3%B8%E9%87%91%E5%B1%9Eironic%E5%88%9B%E5%BB%BA%E5%8F%8A%E8%B0%83%E5%BA%A6-3/index.html">
  
    <link rel="alternate" href="/atom.xml" title="小白技术博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
  
<meta name="generator" content="Hexo 5.2.0"></head>


<body class="main-center" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://github.com/cofess" target="_blank">
          <img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">昵称</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md">Web Developer &amp; Designer</h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Shenzhen, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="Search" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="Type something..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav ">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">Home</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">Archives</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">Categories</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags">
            
            <i class="icon icon-tags"></i>
            
            <span class="menu-title">Tags</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-repository">
          <a href="/repository">
            
            <i class="icon icon-project"></i>
            
            <span class="menu-title">Repository</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-books">
          <a href="/books">
            
            <i class="icon icon-book-fill"></i>
            
            <span class="menu-title">Books</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-links">
          <a href="/links">
            
            <i class="icon icon-friendship"></i>
            
            <span class="menu-title">Links</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-about">
          <a href="/about">
            
            <i class="icon icon-cup-fill"></i>
            
            <span class="menu-title">About</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/cofess" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://weibo.com/cofess" target="_blank" title="Weibo" data-toggle=tooltip data-placement=top><i class="icon icon-weibo"></i></a></li>
        
        <li><a href="https://twitter.com/iwebued" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
        <li><a href="https://www.behance.net/cofess" target="_blank" title="Behance" data-toggle=tooltip data-placement=top><i class="icon icon-behance"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">Board</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p>欢迎交流与分享经验!</p>
            </div>
        </div>
    </div>
</div>

    
      

    
      
  <div class="widget">
    <h3 class="widget-title">Tags</h3>
    <div class="widget-body">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ELK/" rel="tag">ELK</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/django/" rel="tag">django</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/elastic/" rel="tag">elastic</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/etcd/" rel="tag">etcd</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go/" rel="tag">go</a><span class="tag-list-count">19</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grpc/" rel="tag">grpc</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iptables/" rel="tag">iptables</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kata/" rel="tag">kata</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kube-ovn/" rel="tag">kube-ovn</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kubernetes/" rel="tag">kubernetes</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mariadb/" rel="tag">mariadb</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/" rel="tag">mysql</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openstack/" rel="tag">openstack</a><span class="tag-list-count">35</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spdk/" rel="tag">spdk</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/" rel="tag">云计算</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%85%B3%E4%BA%8E%E4%BD%9C%E8%80%85/" rel="tag">关于作者</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" rel="tag">大数据</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" rel="tag">微服务</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E5%AD%A6%E7%94%9F%E6%B4%BB/" rel="tag">文学生活</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BC%8F%E6%B4%9E%E5%AE%89%E5%85%A8/" rel="tag">漏洞安全</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F/" rel="tag">监控系统</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%99%9A%E6%8B%9F%E5%8C%96/" rel="tag">虚拟化</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" rel="tag">面试题</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget-body tagcloud">
      <a href="/tags/ELK/" style="font-size: 13px;">ELK</a> <a href="/tags/Linux/" style="font-size: 13.73px;">Linux</a> <a href="/tags/django/" style="font-size: 13px;">django</a> <a href="/tags/docker/" style="font-size: 13.36px;">docker</a> <a href="/tags/elastic/" style="font-size: 13px;">elastic</a> <a href="/tags/etcd/" style="font-size: 13px;">etcd</a> <a href="/tags/git/" style="font-size: 13px;">git</a> <a href="/tags/go/" style="font-size: 13.91px;">go</a> <a href="/tags/grpc/" style="font-size: 13.09px;">grpc</a> <a href="/tags/iptables/" style="font-size: 13px;">iptables</a> <a href="/tags/kata/" style="font-size: 13.45px;">kata</a> <a href="/tags/kube-ovn/" style="font-size: 13px;">kube-ovn</a> <a href="/tags/kubernetes/" style="font-size: 13.82px;">kubernetes</a> <a href="/tags/linux/" style="font-size: 13.64px;">linux</a> <a href="/tags/mariadb/" style="font-size: 13px;">mariadb</a> <a href="/tags/mysql/" style="font-size: 13.36px;">mysql</a> <a href="/tags/openstack/" style="font-size: 14px;">openstack</a> <a href="/tags/python/" style="font-size: 13.18px;">python</a> <a href="/tags/spdk/" style="font-size: 13.27px;">spdk</a> <a href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/" style="font-size: 13px;">云计算</a> <a href="/tags/%E5%85%B3%E4%BA%8E%E4%BD%9C%E8%80%85/" style="font-size: 13px;">关于作者</a> <a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" style="font-size: 13px;">大数据</a> <a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" style="font-size: 13px;">微服务</a> <a href="/tags/%E6%96%87%E5%AD%A6%E7%94%9F%E6%B4%BB/" style="font-size: 13px;">文学生活</a> <a href="/tags/%E6%BC%8F%E6%B4%9E%E5%AE%89%E5%85%A8/" style="font-size: 13px;">漏洞安全</a> <a href="/tags/%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F/" style="font-size: 13px;">监控系统</a> <a href="/tags/%E8%99%9A%E6%8B%9F%E5%8C%96/" style="font-size: 13.55px;">虚拟化</a> <a href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" style="font-size: 13px;">面试题</a>
    </div>
  </div>

    
      
  <div class="widget">
    <h3 class="widget-title">Archive</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a><span class="archive-list-count">17</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a><span class="archive-list-count">16</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a><span class="archive-list-count">19</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2022/07/28/%E8%99%9A%E6%8B%9F%E5%8C%96-numa%E6%9E%B6%E6%9E%84%E8%AE%B2%E8%A7%A3-1/" class="title">虚拟化-numa架构讲解(1)</a>
              </p>
              <p class="item-date">
                <time datetime="2022-07-28T07:43:26.000Z" itemprop="datePublished">2022-07-28</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2022/07/27/go-%E5%AE%9E%E7%94%A8%E6%96%B9%E6%B3%95-%E5%88%A4%E6%96%AD%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%BAuuid%E7%B1%BB%E5%9E%8B/" class="title">go-实用方法-判断字符串为uuid类型</a>
              </p>
              <p class="item-date">
                <time datetime="2022-07-27T02:41:41.000Z" itemprop="datePublished">2022-07-27</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2022/02/25/go-etcd-clientv3-%E5%8C%85%E5%86%B2%E7%AA%81%E9%97%AE%E9%A2%98/" class="title">go-etcd clientv3 包冲突问题</a>
              </p>
              <p class="item-date">
                <time datetime="2022-02-25T09:26:39.000Z" itemprop="datePublished">2022-02-25</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2022/02/16/openstack-%E5%9F%BA%E4%BA%8E%E6%99%BA%E8%83%BD%E7%BD%91%E5%8D%A1%E7%9A%84%E7%83%AD%E8%BF%81%E7%A7%BB%E5%AE%9E%E7%8E%B0/" class="title">openstack-基于智能网卡的热迁移实现</a>
              </p>
              <p class="item-date">
                <time datetime="2022-02-16T03:09:01.000Z" itemprop="datePublished">2022-02-16</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2022/02/14/openstack-%E5%9F%BA%E4%BA%8Epacker%E8%87%AA%E5%8A%A8%E5%8C%96build%E9%95%9C%E5%83%8F/" class="title">openstack-基于packer自动化build镜像</a>
              </p>
              <p class="item-date">
                <time datetime="2022-02-14T01:57:22.000Z" itemprop="datePublished">2022-02-14</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<main class="main" role="main">
  <div class="content">
  <article id="post-openstack-裸金属ironic创建及调度-3" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      openstack-裸金属ironic创建及调度-3
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2021/05/07/openstack-%E8%A3%B8%E9%87%91%E5%B1%9Eironic%E5%88%9B%E5%BB%BA%E5%8F%8A%E8%B0%83%E5%BA%A6-3/" class="article-date">
	  <time datetime="2021-05-07T04:04:08.000Z" itemprop="datePublished">2021-05-07</time>
	</a>
</span>
        
        
  <span class="article-tag">
    <i class="icon icon-tags"></i>
	<a class="article-tag-link-link" href="/tags/openstack/" rel="tag">openstack</a>
  </span>


        

        <span class="post-comment"><i class="icon icon-comment"></i> <a href="/2021/05/07/openstack-%E8%A3%B8%E9%87%91%E5%B1%9Eironic%E5%88%9B%E5%BB%BA%E5%8F%8A%E8%B0%83%E5%BA%A6-3/#comments" class="article-comment-link">Comments</a></span>
        
      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <h2 id="云盘支持"><a href="#云盘支持" class="headerlink" title="云盘支持"></a>云盘支持</h2><p>When user starts bare metal instance with Cinder volume, Nova orchestrates the communication with Cinder and Ironic. The work flow of the boot process is as follows:</p>
<ol>
<li>(Preparation) Administrator registers a node with initiator information.</li>
<li>User asks Cinder to create a boot volume.</li>
<li>User asks Nova to boot a node from the Cinder volume.</li>
<li>Nova calls Ironic to collect iSCSI/FC initiator information. Ironic collects initiator information and returns it to Nova.</li>
<li>Nova calls Cinder to attach the volume to the node. Cinder attaches the volume to the node and returns connection information which includes target information.</li>
<li>Nova passes the target information for the node to Ironic</li>
<li>Nova calls Ironic to spawn the instance. Ironic prepares the bare metal node to boot from the remote volume which is identified by target information and powers on the bare metal node.</li>
</ol>
<p>In the work flow above, Nova calls Ironic to get/set initiator/target information (4 and 6) and also administrator calls Ironic to set initiator information (1) but currently Ironic has neither those information nor APIs for them.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#pip install rbd-iscsi-client&#x3D;&#x3D;0.1.8 -i https:&#x2F;&#x2F;pypi.tuna.tsinghua.edu.cn&#x2F;simple</span><br><span class="line">#cinder type-create rbd_iscsi</span><br><span class="line">#cinder type-key rbd_iscsi set volume_backend_name&#x3D;rbd_iscsi</span><br><span class="line">#cinder create 100 --display-name iscsi_boot1 --volume-type rbd_iscsi --image-id 3ec7c300-78bc-4d4b-bb1d-aaab4b4c35d7</span><br><span class="line">#cinder create 100 --display-name iscsi_boot2 --volume-type rbd_iscsi</span><br><span class="line">#openstack baremetal node set --storage-interface cinder 5e10c067-c0c6-48be-ac6e-749a70045b97</span><br><span class="line">#openstack baremetal node set --property capabilities&#x3D;iscsi_boot:True 5e10c067-c0c6-48be-ac6e-749a70045b97</span><br><span class="line"></span><br><span class="line">这一步可以理解为注册主机，target中host信息，id名称随便起，最大64bytes</span><br><span class="line">#openstack baremetal volume connector create --node 5e10c067-c0c6-48be-ac6e-749a70045b97 --type iqn --connector-id iqn.2021-04.net.*****.sh.cluster.5e10c067-c0c6-48be-ac6e-749a70045b97</span><br><span class="line">为该裸机分配磁盘 volume</span><br><span class="line">#openstack baremetal volume target create --node 5e10c067-c0c6-48be-ac6e-749a70045b97 --type iscsi --boot-index 0 --volume cfa8c986-7a79-48fd-88a0-aa997d579fbf --property auth_method&#x3D;&quot;CHAP&quot; --property auth_username&#x3D;&quot;admin&quot; --property auth_password&#x3D;&quot;admin&quot;</span><br><span class="line">#openstack baremetal volume target create --node 5e10c067-c0c6-48be-ac6e-749a70045b97 --type iscsi --boot-index 1 --volume 4e4e41e3-fbfb-4737-bd93-863f48470244 --property auth_method&#x3D;&quot;CHAP&quot; --property auth_username&#x3D;&quot;admin&quot; --property auth_password&#x3D;&quot;admin&quot;</span><br><span class="line"></span><br><span class="line">#openstack server create --image 3ec7c300-78bc-4d4b-bb1d-aaab4b4c35d7 --flavor bms.large --nic net-id&#x3D;cb1356ca-e79b-4d7b-ad29-3267e4c2bc41 bm01</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#cinder create 100 --display-name centos7-grub2-iscsi-pwd  --image-id ea4266e4-456e-4fe0-91c9-a8c15dd2d2d6 --volume-type rbd_iscsi</span><br><span class="line">#gwcli</span><br><span class="line">&gt;cd &#x2F;disks&#x2F;</span><br><span class="line">&gt;create iscsi-data image&#x3D;volume-98ebbe5c-a32f-45ee-be04-61c295bcabe4 size&#x3D;100g</span><br><span class="line">&gt;goto hosts</span><br><span class="line">&gt;create iqn.2021-01.net.*****.sh***:server01</span><br><span class="line">&gt;disk add iscsi-data&#x2F;volume-98ebbe5c-a32f-45ee-be04-61c295bcabe4 size&#x3D;100g</span><br></pre></td></tr></table></figure>



<p>常见问题：</p>
<ol>
<li>volume状态是否是available</li>
<li></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#cat &#x2F;data&#x2F;docker&#x2F;volumes&#x2F;ironic_ipxe&#x2F;_data&#x2F;78\:ac\:44\:04\:f1\:a9.conf </span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">#!ipxe</span><br><span class="line"></span><br><span class="line">set attempts:int32 10</span><br><span class="line">set i:int32 0</span><br><span class="line"></span><br><span class="line">goto deploy</span><br><span class="line"></span><br><span class="line">:deploy</span><br><span class="line">imgfree</span><br><span class="line">kernel  selinux&#x3D;0 troubleshoot&#x3D;0 text nofb nomodeset vga&#x3D;normal console&#x3D;tty0 console&#x3D;ttyS0,115200n8 ipa-debug&#x3D;1 BOOTIF&#x3D;$&#123;mac&#125; ipa-api-url&#x3D;http:&#x2F;&#x2F;10.218.105.100:6385 initrd&#x3D;deploy_ramdisk coreos.configdrive&#x3D;0 || goto retry</span><br><span class="line"></span><br><span class="line">initrd  || goto retry</span><br><span class="line">boot</span><br><span class="line"></span><br><span class="line">:retry</span><br><span class="line">iseq $&#123;i&#125; $&#123;attempts&#125; &amp;&amp; goto fail ||</span><br><span class="line">inc i</span><br><span class="line">echo No response, retrying in &#123;i&#125; seconds.</span><br><span class="line">sleep $&#123;i&#125;</span><br><span class="line">goto deploy</span><br><span class="line"></span><br><span class="line">:fail</span><br><span class="line">echo Failed to get a response after $&#123;attempts&#125; attempts</span><br><span class="line">echo Powering off in 30 seconds.</span><br><span class="line">sleep 30</span><br><span class="line">poweroff</span><br><span class="line"></span><br><span class="line">:boot_partition</span><br><span class="line">imgfree</span><br><span class="line">kernel no_kernel root&#x3D;&#123;&#123; ROOT &#125;&#125; ro text nofb nomodeset vga&#x3D;normal console&#x3D;tty0 console&#x3D;ttyS0,115200n8 ipa-debug&#x3D;1 initrd&#x3D;ramdisk || goto boot_partition</span><br><span class="line">initrd no_ramdisk || goto boot_partition</span><br><span class="line">boot</span><br><span class="line"></span><br><span class="line">:boot_ramdisk</span><br><span class="line">imgfree</span><br><span class="line">kernel no_kernel root&#x3D;&#x2F;dev&#x2F;ram0 text nofb nomodeset vga&#x3D;normal console&#x3D;tty0 console&#x3D;ttyS0,115200n8 ipa-debug&#x3D;1  initrd&#x3D;ramdisk || goto boot_ramdisk</span><br><span class="line">initrd no_ramdisk || goto boot_ramdisk</span><br><span class="line">boot</span><br><span class="line"></span><br><span class="line">:boot_iscsi</span><br><span class="line">imgfree</span><br><span class="line">set username iqn.2021-04.net.*****.5e10c067-c0c6-48be-ac6e-749a70045b97</span><br><span class="line">set password Cc6BK5uTbCsH6hCF</span><br><span class="line">set initiator-iqn iqn.2021-04.net.*****.5e10c067-c0c6-48be-ac6e-749a70045b97</span><br><span class="line">sanhook --drive 0x80 iscsi:10.206.79.34::3260:1:iqn.2021-04.net.*****.iscsi-gw:ceph-igw || goto fail_iscsi_retry</span><br><span class="line">set username admin</span><br><span class="line">set password admin</span><br><span class="line">sanhook --drive 0x81 iscsi::::: || goto fail_iscsi_retry</span><br><span class="line">set username iqn.2021-04.net.*****.5e10c067-c0c6-48be-ac6e-749a70045b97</span><br><span class="line">set password Cc6BK5uTbCsH6hCF</span><br><span class="line">sanboot --no-describe || goto fail_iscsi_retry</span><br><span class="line"></span><br><span class="line">:fail_iscsi_retry</span><br><span class="line">echo Failed to attach iSCSI volume(s), retrying in 10 seconds.</span><br><span class="line">sleep 10</span><br><span class="line">goto boot_iscsi</span><br><span class="line"></span><br><span class="line">:boot_whole_disk</span><br></pre></td></tr></table></figure>





<p>bs=16k, iodepth=1</p>
<p>吞吐</p>
<table>
<thead>
<tr>
<th></th>
<th>顺序读</th>
<th>顺序写</th>
<th>随机读</th>
<th>随机写</th>
<th>混合随机读写</th>
</tr>
</thead>
<tbody><tr>
<td>数据云盘sata</td>
<td>246MB</td>
<td>41.8MB</td>
<td>291MB</td>
<td>10.1MB</td>
<td>7799kB/7894kB</td>
</tr>
<tr>
<td>物理盘(sas*2 raid1)</td>
<td>584MB</td>
<td>1418MB/s</td>
<td>127MB</td>
<td>65.4MB</td>
<td>40.2MB/40.1MB</td>
</tr>
</tbody></table>
<p>IOPS</p>
<table>
<thead>
<tr>
<th></th>
<th>顺序读</th>
<th>顺序写</th>
<th>随机读</th>
<th>随机写</th>
<th>混合随机读写</th>
</tr>
</thead>
<tbody><tr>
<td>数据云盘sata</td>
<td>15.0k</td>
<td>2550</td>
<td>17.8k</td>
<td>618</td>
<td>476/481</td>
</tr>
<tr>
<td>物理盘(sas*2 raid1)</td>
<td>35.7k</td>
<td>86.6k</td>
<td>7747</td>
<td>3990</td>
<td>2451/2450</td>
</tr>
</tbody></table>
<p>bs=4k,iodepth=1</p>
<p>吞吐</p>
<table>
<thead>
<tr>
<th></th>
<th>顺序读</th>
<th>顺序写</th>
<th>随机读</th>
<th>随机写</th>
<th>混合随机读写</th>
</tr>
</thead>
<tbody><tr>
<td>数据云盘sata</td>
<td>112MB</td>
<td>14.1MB</td>
<td>93.1MB</td>
<td>2490kB</td>
<td>2212kB/2238kB</td>
</tr>
<tr>
<td>物理盘(sas*2 raid1)</td>
<td>367MB</td>
<td>372MB</td>
<td>21.4MB</td>
<td>15.0MB</td>
<td>7252kB/7263kB</td>
</tr>
</tbody></table>
<p>IOPS</p>
<table>
<thead>
<tr>
<th></th>
<th>顺序读</th>
<th>顺序写</th>
<th>随机读</th>
<th>随机写</th>
<th>混合随机读写</th>
</tr>
</thead>
<tbody><tr>
<td>数据云盘sata</td>
<td>27.3k</td>
<td>3431</td>
<td>22.7k</td>
<td>607</td>
<td>559/565</td>
</tr>
<tr>
<td>物理盘(sas*2 raid1)</td>
<td>89.5k</td>
<td>90.8k</td>
<td>5223</td>
<td>3904</td>
<td>1770/1773</td>
</tr>
</tbody></table>
<p>吞吐 bs=1024k,iodepth=128,size=50G,ioengine=psync </p>
<table>
<thead>
<tr>
<th></th>
<th>顺序读</th>
<th>顺序写</th>
<th>随机读</th>
<th>随机写</th>
<th>混合随机读写</th>
</tr>
</thead>
<tbody><tr>
<td>iSCSI云盘sata 600G</td>
<td>840MB</td>
<td>85MB</td>
<td>830MB</td>
<td>140MB</td>
<td>135MB/140MB</td>
</tr>
<tr>
<td>iSCSI云盘sata 4T</td>
<td>840MB</td>
<td>97MB</td>
<td>870MB</td>
<td>140MB</td>
<td>135MB/140MB</td>
</tr>
<tr>
<td>物理盘(sas*2 raid1) 600G</td>
<td>520MB</td>
<td>2650MB</td>
<td>290MB</td>
<td>150MB</td>
<td>95MB/95MB</td>
</tr>
<tr>
<td>物理盘(sata*1 raid0) 4T</td>
<td>340MB</td>
<td>140MB</td>
<td>100MB</td>
<td>120MB</td>
<td>55MB/60MB</td>
</tr>
<tr>
<td>物理盘(ssd*1 raid0) 800G</td>
<td>280MB</td>
<td>230MB</td>
<td>420MB</td>
<td>350MB</td>
<td>175MB/180MB</td>
</tr>
</tbody></table>
<p>IOPS bs=4k,iodepth=128,size=50G,ioengine=psync</p>
<table>
<thead>
<tr>
<th></th>
<th>顺序读</th>
<th>顺序写</th>
<th>随机读</th>
<th>随机写</th>
<th>混合随机读写</th>
</tr>
</thead>
<tbody><tr>
<td>iSCSI云盘sata 600G</td>
<td>25.9k</td>
<td>2663</td>
<td>20k</td>
<td>799</td>
<td>602/609</td>
</tr>
<tr>
<td>iSCSI云盘sata 4T</td>
<td>26k</td>
<td>3167</td>
<td>25k</td>
<td>828</td>
<td>600/600</td>
</tr>
<tr>
<td>物理盘(sas*2 raid1) 600G</td>
<td>82.0k</td>
<td>92.3k</td>
<td>901</td>
<td>1232</td>
<td>685/694</td>
</tr>
<tr>
<td>物理盘(sata*1 raid0) 4T</td>
<td>5.8k</td>
<td>7k</td>
<td>327</td>
<td>276</td>
<td>142/148</td>
</tr>
<tr>
<td>物理盘(ssd*1 raid0) 800G</td>
<td>47.9k</td>
<td>6k</td>
<td>46.4k</td>
<td>39.6k</td>
<td>20.2k/20.2k</td>
</tr>
</tbody></table>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="https://blog.kubestack.cn/2021/05/07/openstack-%E8%A3%B8%E9%87%91%E5%B1%9Eironic%E5%88%9B%E5%BB%BA%E5%8F%8A%E8%B0%83%E5%BA%A6-3/" title="openstack-裸金属ironic创建及调度-3" target="_blank" rel="external">https://blog.kubestack.cn/2021/05/07/openstack-裸金属ironic创建及调度-3/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/cofess" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.jpg" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/cofess" target="_blank"><span class="text-dark">昵称</span><small class="ml-1x">Web Developer &amp; Designer</small></a></h3>
        <div>个人简介。</div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    
  <section id="comments">
  	
      <div id="vcomments"></div>
    
  </section>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2021/05/27/openstack-%E8%A3%B8%E9%87%91%E5%B1%9Eironic%E6%BA%90%E7%A0%81%E5%88%9B%E5%BB%BA%E5%88%86%E6%9E%90/" title="openstack-裸金属ironic源码创建分析"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;Newer</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2021/04/25/openstack-%E8%A3%B8%E9%87%91%E5%B1%9Eironic%E5%88%9B%E5%BB%BA%E5%8F%8A%E8%B0%83%E5%BA%A6-2/" title="openstack-裸金属ironic创建及调度-2"><span>Older&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
  </ul>
  
  
  <!-- Button trigger modal -->
  <button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>$</span></button>
  <!-- <div class="wave-icon wave-icon-danger btn-donate" data-toggle="modal" data-target="#donateModal">
    <div class="wave-circle"><span class="icon"><i class="icon icon-bill"></i></span></div>
  </div> -->
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div>
    
  </div>
  </div>
</nav>
  
<!-- Modal -->
<div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content donate">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <div class="modal-body">
        <div class="donate-box">
          <div class="donate-head">
            <p>Maybe you could buy me a cup of coffee.</p>
          </div>
          <div class="tab-content">
            <div role="tabpanel" class="tab-pane fade active in" id="alipay">
              <div class="donate-payimg">
                <img src="/images/donate/alipayimg.png" alt="Scan Qrcode" title="Scan" />
              </div>
              <p class="text-muted mv">Scan this qrcode</p>
              <p class="text-grey">Open alipay app scan this qrcode, buy me a coffee!</p>
            </div>
            <div role="tabpanel" class="tab-pane fade" id="wechatpay">
              <div class="donate-payimg">
                <img src="/images/donate/wechatpayimg.png" alt="Scan Qrcode" title="Scan" />
              </div>
              <p class="text-muted mv">Scan this qrcode</p>
              <p class="text-grey">Open wechat app scan this qrcode, buy me a coffee!</p>
            </div>
          </div>
          <div class="donate-footer">
            <ul class="nav nav-tabs nav-justified" role="tablist">
              <li role="presentation" class="active">
                <a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> alipay</a>
              </li>
              <li role="presentation" class="">
                <a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> wechat payment</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>



</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/cofess" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://weibo.com/cofess" target="_blank" title="Weibo" data-toggle=tooltip data-placement=top><i class="icon icon-weibo"></i></a></li>
        
        <li><a href="https://twitter.com/iwebued" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
        <li><a href="https://www.behance.net/cofess" target="_blank" title="Behance" data-toggle=tooltip data-placement=top><i class="icon icon-behance"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        <div class="publishby">
        	Theme by <a href="https://github.com/cofess" target="_blank"> cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.
        </div>
    </div>
</footer>
  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>






   




   
    
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/valine"></script>
  <script type="text/javascript">
  var GUEST = ['nick', 'mail', 'link'];
  var meta = 'nick,mail,link';
  meta = meta.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#vcomments',
    verify: false,
    notify: false,
    appId: '',
    appKey: '',
    placeholder: 'Just go go',
    avatar: 'mm',
    meta: meta,
    pageSize: '10' || 10,
    visitor: false
  });
  </script>

     







</body>
</html>