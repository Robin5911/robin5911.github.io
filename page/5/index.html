<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
<script type="text/javascript">
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?ae11d5a19bdcf766771692d64967eeb1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

  

  
  <title>小白博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="云计算&#x2F;编程语言&#x2F;数据库&#x2F;容器化&#x2F;虚拟化">
<meta property="og:type" content="website">
<meta property="og:title" content="小白博客">
<meta property="og:url" content="https://blog.kubestack.cn/page/5/index.html">
<meta property="og:site_name" content="小白博客">
<meta property="og:description" content="云计算&#x2F;编程语言&#x2F;数据库&#x2F;容器化&#x2F;虚拟化">
<meta property="og:locale">
<meta property="article:author" content="Tonyzhang1989">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="小白博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="https://fonts.lug.ustc.edu.cn/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="google-site-verification" content="XkIGmrbqh5J83cILz5wx9StkgaQzjhGx0UfHTxlma00" />

<meta name="generator" content="Hexo 5.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">小白博客</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://blog.kubestack.cn"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-logstash-基于docker部署" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/08/31/logstash-%E5%9F%BA%E4%BA%8Edocker%E9%83%A8%E7%BD%B2/" class="article-date">
  <time datetime="2021-08-31T08:51:59.000Z" itemprop="datePublished">2021-08-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/08/31/logstash-%E5%9F%BA%E4%BA%8Edocker%E9%83%A8%E7%BD%B2/">logstash - 基于docker部署</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>下载docker镜像</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#docker pull docker.elastic.co&#x2F;logstash&#x2F;logstash:7.6.2</span><br></pre></td></tr></table></figure>

<p>创建本地配置目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#mkdir &#x2F;usr&#x2F;local&#x2F;logstash&#x2F;config</span><br></pre></td></tr></table></figure>

<p>配置logstash.yml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#vim &#x2F;usr&#x2F;local&#x2F;logstash&#x2F;config&#x2F;logstash.yml</span><br><span class="line"></span><br><span class="line">config:</span><br><span class="line">  reload:</span><br><span class="line">    automatic: true</span><br><span class="line">    interval: 3s</span><br><span class="line">xpack:</span><br><span class="line">  management.enabled: false</span><br><span class="line">  monitoring.enabled: false</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.kubestack.cn/2021/08/31/logstash-%E5%9F%BA%E4%BA%8Edocker%E9%83%A8%E7%BD%B2/" data-id="cktcrags40001hs16f0zr61l3" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ELK/" rel="tag">ELK</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-openstack硬件加速器管理-Cyborg调研" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/08/30/openstack%E7%A1%AC%E4%BB%B6%E5%8A%A0%E9%80%9F%E5%99%A8%E7%AE%A1%E7%90%86-Cyborg%E8%B0%83%E7%A0%94/" class="article-date">
  <time datetime="2021-08-30T03:38:07.000Z" itemprop="datePublished">2021-08-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/08/30/openstack%E7%A1%AC%E4%BB%B6%E5%8A%A0%E9%80%9F%E5%99%A8%E7%AE%A1%E7%90%86-Cyborg%E8%B0%83%E7%A0%94/">openstack硬件加速器管理 - Cyborg调研</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><p>随着5G、互联网、物联网等技术的发展, 对计算业务进行加速、卸载的需求日渐增多, Cyborg项目由此诞生。</p>
<p>Cyborg(以前叫做Nomad)是OpenStack用于管理硬件和软件加速资源框架, 包括GPU、FPGA、加解密卡, NVMe/NOF SSDs, ODP, DPDK/SPDK等, Cyborg就是OpenStack中的加速即服务(Acceleration as a Service)。该项目在OpenStack Q版本时正式发布, 由华为、联想、红帽主导，是一个很年轻的项目, 目前功能还不是很完善。</p>
<p>Cyborg通过管理、使用计算节点上的加速器硬件, 可以提供电信运营商在NFV以及边缘计算场景下的各种加速服务、提高用户体验、降低CPU负载。运维人员可以通过Cyborg列出、识别和发现加速器，挂载、卸载加速器实例, 安装、卸载驱动。它可以单独使用或与 Nova 或 Ironic 结合使用。</p>
<h4 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h4><p>Cyborg采用经典架构，由cyborg-api、cyborg-conductor、cyborg-agent、 cyborg-db几个模块组成。其中Cyborg-agent位于计算节点，用于监控加速器；cyborg-conductor位于控制节点，管理整个系统和操作数据库。cyborg-api和cyborg-db分别为接口和数据库，均位于控制节点。</p>
<p><img src="/images/cyborg.jpg"></p>
<h4 id="工作流程"><a href="#工作流程" class="headerlink" title="工作流程"></a>工作流程</h4><p>从Cyborg的架构图和API来看, 其主要工作流程如下:</p>
<ol>
<li><p>cyborg-api会接收用户创建加速器的API调用, 通过cyborg-conductor保存到cyborg-db</p>
</li>
<li><p>cyborg-conductor通过rpc调用计算节点上的cyborg-agent, cyborg-agent会调用对应的厂商驱动, 最后由厂商驱动来执行配置计算节点底层的加速资源</p>
</li>
<li><p>计算节点上的cyborg-agent通过定时查询加速资源使用情况, 并通过API发送给placement服务, 该信息最终会给nova在调度时使用。</p>
</li>
</ol>
<p>注: 由于加速设备可能存在多个设备互相关联的层次化结构, 如SRIOV PF和VF之间有关联关系。Nova在O版时, 为resource-providers数据库进行了扩展, 支持了设备的层次化关系。</p>
<p><a target="_blank" rel="noopener" href="http://specs.openstack.org/openstack/nova-specs/specs/ocata/approved/nested-resource-providers.html">http://specs.openstack.org/openstack/nova-specs/specs/ocata/approved/nested-resource-providers.html</a></p>
<ol start="4">
<li>Nova进行调度, 并在虚拟机中挂载虚拟加速设备给用户使用</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.kubestack.cn/2021/08/30/openstack%E7%A1%AC%E4%BB%B6%E5%8A%A0%E9%80%9F%E5%99%A8%E7%AE%A1%E7%90%86-Cyborg%E8%B0%83%E7%A0%94/" data-id="cktcragsp0006hs169s554wna" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openstack/" rel="tag">openstack</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-mysql-查询重复数据" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/08/26/mysql-%E6%9F%A5%E8%AF%A2%E9%87%8D%E5%A4%8D%E6%95%B0%E6%8D%AE/" class="article-date">
  <time datetime="2021-08-26T02:11:05.000Z" itemprop="datePublished">2021-08-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/08/26/mysql-%E6%9F%A5%E8%AF%A2%E9%87%8D%E5%A4%8D%E6%95%B0%E6%8D%AE/">mysql-查询重复数据</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>查询表中重复数据，展示出字段内容和count</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; select user_name,count(*) as count from user group by user_name having count&gt;1;</span><br></pre></td></tr></table></figure>




      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.kubestack.cn/2021/08/26/mysql-%E6%9F%A5%E8%AF%A2%E9%87%8D%E5%A4%8D%E6%95%B0%E6%8D%AE/" data-id="ckssanb3y0001to16fh0m6bol" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-openstack-裸金属ironic源码创建分析" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/05/27/openstack-%E8%A3%B8%E9%87%91%E5%B1%9Eironic%E6%BA%90%E7%A0%81%E5%88%9B%E5%BB%BA%E5%88%86%E6%9E%90/" class="article-date">
  <time datetime="2021-05-27T07:19:26.000Z" itemprop="datePublished">2021-05-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/05/27/openstack-%E8%A3%B8%E9%87%91%E5%B1%9Eironic%E6%BA%90%E7%A0%81%E5%88%9B%E5%BB%BA%E5%88%86%E6%9E%90/">openstack-裸金属ironic源码创建分析</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>openstack ironic 裸金属创建裸机流程源码分析</p>
<p>基于 ironic stein</p>
<p>ironic-api接收到了provision_state的设置请求，然后返回202的异步请求，api请求到了ironic.api.controllers.v1.node.NodeStatesController的provision方法， 然后调用了 _do_provision_action 方法 。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@METRICS.timer(&#39;NodeStatesController.provision&#39;)</span><br><span class="line">@expose.expose(None, types.uuid_or_name, wtypes.text,</span><br><span class="line">               types.jsontype, types.jsontype, wtypes.text,</span><br><span class="line">               status_code&#x3D;http_client.ACCEPTED)</span><br><span class="line">def provision(self, node_ident, target, configdrive&#x3D;None,</span><br><span class="line">              clean_steps&#x3D;None, rescue_password&#x3D;None):</span><br><span class="line">***************</span><br><span class="line">self._do_provision_action(rpc_node, target, configdrive, clean_steps,</span><br><span class="line">                              rescue_password)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">def _do_provision_action(self, rpc_node, target, configdrive&#x3D;None,</span><br><span class="line">                             clean_steps&#x3D;None, rescue_password&#x3D;None):</span><br><span class="line">     ************</span><br><span class="line">     if target in (ir_states.ACTIVE, ir_states.REBUILD):</span><br><span class="line">            rebuild &#x3D; (target &#x3D;&#x3D; ir_states.REBUILD)</span><br><span class="line">            pecan.request.rpcapi.do_node_deploy(context&#x3D;pecan.request.context,</span><br><span class="line">                                                node_id&#x3D;rpc_node.uuid,</span><br><span class="line">                                                rebuild&#x3D;rebuild,</span><br><span class="line">                                                configdrive&#x3D;configdrive,</span><br><span class="line">                                                topic&#x3D;topic)                         </span><br></pre></td></tr></table></figure>

<p>然后RPC调用的ironic.condutor.manager.ConductorManager.do_node_deploy方法, 最终启动一个task ，调用 ironic.condutor.manager.do_node_deploy方法， 如果配置了configdrive会传至swift接口，然后调用 task.driver.deploy.prepare(task) 过程， 不同驱动的动作不一样 pxe_* 驱动使用的是iscsi_deploy.ISCSIDeploy.prepare，本地用的  task.driver.deploy.deploy</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">@METRICS.timer(&#39;ConductorManager.do_node_deploy&#39;)</span><br><span class="line">@messaging.expected_exceptions(exception.NoFreeConductorWorker,</span><br><span class="line">                               exception.NodeLocked,</span><br><span class="line">                               exception.NodeInMaintenance,</span><br><span class="line">                               exception.InstanceDeployFailure,</span><br><span class="line">                               exception.InvalidStateRequested,</span><br><span class="line">                               exception.NodeProtected)</span><br><span class="line">def do_node_deploy(self, context, node_id, rebuild&#x3D;False,</span><br><span class="line">                   configdrive&#x3D;None):</span><br><span class="line">    ********</span><br><span class="line">    #状态相关检查，确保裸机参数及电源正常</span><br><span class="line">     try:</span><br><span class="line">            task.driver.power.validate(task)</span><br><span class="line">            task.driver.deploy.validate(task)</span><br><span class="line">            utils.validate_instance_info_traits(task.node)</span><br><span class="line">            conductor_steps.validate_deploy_templates(task)</span><br><span class="line">        except exception.InvalidParameterValue as e:</span><br><span class="line">            raise exception.InstanceDeployFailure(</span><br><span class="line">                _(&quot;Failed to validate deploy or power info for node &quot;</span><br><span class="line">                  &quot;%(node_uuid)s. Error: %(msg)s&quot;) %</span><br><span class="line">                &#123;&#39;node_uuid&#39;: node.uuid, &#39;msg&#39;: e&#125;, code&#x3D;e.code)</span><br><span class="line"></span><br><span class="line">        LOG.debug(&quot;do_node_deploy Calling event: %(event)s for node: &quot;</span><br><span class="line">                  &quot;%(node)s&quot;, &#123;&#39;event&#39;: event, &#39;node&#39;: node.uuid&#125;)</span><br><span class="line">        try:</span><br><span class="line">            task.process_event(</span><br><span class="line">                event,</span><br><span class="line">                callback&#x3D;self._spawn_worker,</span><br><span class="line">                call_args&#x3D;(do_node_deploy, task, self.conductor.id,</span><br><span class="line">                           configdrive),</span><br><span class="line">                err_handler&#x3D;utils.provisioning_error_handler)</span><br><span class="line">        except exception.InvalidState:</span><br><span class="line">            raise exception.InvalidStateRequested(</span><br><span class="line">                action&#x3D;event, node&#x3D;task.node.uuid,</span><br><span class="line">                state&#x3D;task.node.provision_state)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@METRICS.timer(&#39;do_node_deploy&#39;)</span><br><span class="line">@task_manager.require_exclusive_lock</span><br><span class="line">def do_node_deploy(task, conductor_id&#x3D;None, configdrive&#x3D;None):</span><br><span class="line">    &quot;&quot;&quot;Prepare the environment and deploy a node.&quot;&quot;&quot;</span><br><span class="line">    node &#x3D; task.node</span><br><span class="line"></span><br><span class="line">    try:</span><br><span class="line">        if configdrive:</span><br><span class="line">            if isinstance(configdrive, dict):</span><br><span class="line">                configdrive &#x3D; utils.build_configdrive(node, configdrive)</span><br><span class="line">            _store_configdrive(node, configdrive)</span><br><span class="line">    ******************</span><br><span class="line">    try:</span><br><span class="line">        task.driver.deploy.prepare(task)</span><br></pre></td></tr></table></figure>

<p>如果是iSCSI启动，task.driver.deploy.prepare(task) 调用 iscsi_deploy.py 的 prepare(task),  初次调用 task.driver.boot.prepare_instance(task) ， 配置dhcp ，准备pxe config和缓存镜像， 通过ipmi操控bios配置启动设备</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">*****</span><br><span class="line">pxe_utils.cache_ramdisk_kernel(task, instance_image_info,</span><br><span class="line">                                           ipxe_enabled&#x3D;CONF.pxe.ipxe_enabled)</span><br><span class="line">*****</span><br><span class="line"> pxe_utils.prepare_instance_pxe_config(</span><br><span class="line">                task, instance_image_info,</span><br><span class="line">                iscsi_boot&#x3D;deploy_utils.is_iscsi_boot(task),</span><br><span class="line">                ramdisk_boot&#x3D;(boot_option &#x3D;&#x3D; &quot;ramdisk&quot;),</span><br><span class="line">                ipxe_enabled&#x3D;CONF.pxe.ipxe_enabled)</span><br><span class="line">*****</span><br><span class="line"># If it&#39;s going to PXE boot we need to update the DHCP server</span><br><span class="line">            dhcp_opts &#x3D; pxe_utils.dhcp_options_for_instance(</span><br><span class="line">                task, ipxe_enabled)</span><br><span class="line">            provider &#x3D; dhcp_factory.DHCPFactory()</span><br><span class="line">            provider.update_dhcp(task, dhcp_opts)  </span><br><span class="line">*****</span><br><span class="line"> manager_utils.node_set_boot_device(task, boot_device,</span><br><span class="line">                                               persistent&#x3D;persistent)</span><br></pre></td></tr></table></figure>

<p>默认本地启动调用 ironic.drivers.modules.pxe.PXERamdiskDeploy.prepare中会检查boot_option是否正确,  然后调用 populate_storage_driver_internal_info，如果使用iSCSI启动，保存boot的volume 信息至internal_info , 最终调用 调用 ironic.drivers.modules.pxe.PXEBoot.prepare_instance  启动部署</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@METRICS.timer(&#39;RamdiskDeploy.prepare&#39;)</span><br><span class="line">   @task_manager.require_exclusive_lock</span><br><span class="line">   def prepare(self, task):</span><br><span class="line">   *****</span><br><span class="line">    deploy_utils.populate_storage_driver_internal_info(task)</span><br><span class="line">    ******</span><br><span class="line">    if node.provision_state in (states.ACTIVE, states.UNRESCUING):</span><br><span class="line">           # In the event of takeover or unrescue.</span><br><span class="line">           task.driver.boot.prepare_instance(task)</span><br></pre></td></tr></table></figure>

<p>调用 ironic.drivers.modules.pxe.PXEBoot.prepare_instance，  配置dhcp ，准备pxe config和缓存镜像， 通过ipmi操控bios配置启动设备</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">****</span><br><span class="line">#缓存镜像到本地</span><br><span class="line">pxe_utils.cache_ramdisk_kernel(task, instance_image_info,</span><br><span class="line">                                           ipxe_enabled&#x3D;CONF.pxe.ipxe_enabled)</span><br><span class="line"> ****</span><br><span class="line"> #为当前裸机准备 单独的 pxe 文件</span><br><span class="line"> pxe_utils.prepare_instance_pxe_config(</span><br><span class="line">                task, instance_image_info,</span><br><span class="line">                iscsi_boot&#x3D;deploy_utils.is_iscsi_boot(task),</span><br><span class="line">                ramdisk_boot&#x3D;(boot_option &#x3D;&#x3D; &quot;ramdisk&quot;),</span><br><span class="line">                ipxe_enabled&#x3D;CONF.pxe.ipxe_enabled)</span><br><span class="line">            boot_device &#x3D; boot_devices.PXE</span><br><span class="line">  *****</span><br><span class="line">  #因pxe启动，需update ironic DHCP配置文件配置pxe,bootfile等信息，本地启动时清理pxe文件更改启动设备为磁盘</span><br><span class="line">  # If it&#39;s going to PXE boot we need to update the DHCP server</span><br><span class="line">            dhcp_opts &#x3D; pxe_utils.dhcp_options_for_instance(</span><br><span class="line">                task, ipxe_enabled)</span><br><span class="line">            provider &#x3D; dhcp_factory.DHCPFactory()</span><br><span class="line">            provider.update_dhcp(task, dhcp_opts)</span><br><span class="line">  ****</span><br><span class="line">  #</span><br><span class="line">  manager_utils.node_set_boot_device(task, boot_device,</span><br><span class="line">                                               persistent&#x3D;persistent)</span><br><span class="line">  ****</span><br><span class="line">  #开始部署</span><br><span class="line">  _do_next_deploy_step(task, 0, conductor_id)</span><br></pre></td></tr></table></figure>

<p>调用task.deploy</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">*****</span><br><span class="line">result &#x3D; interface.execute_deploy_step(task, step)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>如果是iSCSI启动直接调用了 iscsi_deploy.ISCSIDeploy.deploy, cinder盘，不需要缓存镜像，所以，关机，切换租户网络，开机</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">*****</span><br><span class="line"> manager_utils.node_power_action(task, states.POWER_OFF)</span><br><span class="line">            power_state_to_restore &#x3D; (</span><br><span class="line">                manager_utils.power_on_node_if_needed(task))</span><br><span class="line">            task.driver.network.remove_provisioning_network(task)</span><br><span class="line">            task.driver.network.configure_tenant_networks(task)</span><br><span class="line">            manager_utils.restore_power_state_if_needed(</span><br><span class="line">                task, power_state_to_restore)</span><br><span class="line">            task.driver.boot.prepare_instance(task)</span><br><span class="line">            manager_utils.node_power_action(task, states.POWER_ON)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>本地盘 调用pxe.PXEBoot.deploy启动deploy会关机，配置租户网络, 再开机</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">*****</span><br><span class="line">manager_utils.node_power_action(task, states.POWER_OFF)</span><br><span class="line">******</span><br><span class="line"> task.driver.network.configure_tenant_networks(task)</span><br><span class="line">*****</span><br><span class="line">manager_utils.node_power_action(task, states.POWER_ON)</span><br></pre></td></tr></table></figure>

<p>至此deploy完，本地盘会进入ramdisk， iSCSI启动不走ramdisk会直接进去系统，</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.kubestack.cn/2021/05/27/openstack-%E8%A3%B8%E9%87%91%E5%B1%9Eironic%E6%BA%90%E7%A0%81%E5%88%9B%E5%BB%BA%E5%88%86%E6%9E%90/" data-id="ckssanb4b000rto16cdlabyql" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openstack/" rel="tag">openstack</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-openstack-裸金属ironic创建及调度-3" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/05/07/openstack-%E8%A3%B8%E9%87%91%E5%B1%9Eironic%E5%88%9B%E5%BB%BA%E5%8F%8A%E8%B0%83%E5%BA%A6-3/" class="article-date">
  <time datetime="2021-05-07T04:04:08.000Z" itemprop="datePublished">2021-05-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/05/07/openstack-%E8%A3%B8%E9%87%91%E5%B1%9Eironic%E5%88%9B%E5%BB%BA%E5%8F%8A%E8%B0%83%E5%BA%A6-3/">openstack-裸金属ironic创建及调度-3</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="云盘支持"><a href="#云盘支持" class="headerlink" title="云盘支持"></a>云盘支持</h2><p>When user starts bare metal instance with Cinder volume, Nova orchestrates the communication with Cinder and Ironic. The work flow of the boot process is as follows:</p>
<ol>
<li>(Preparation) Administrator registers a node with initiator information.</li>
<li>User asks Cinder to create a boot volume.</li>
<li>User asks Nova to boot a node from the Cinder volume.</li>
<li>Nova calls Ironic to collect iSCSI/FC initiator information. Ironic collects initiator information and returns it to Nova.</li>
<li>Nova calls Cinder to attach the volume to the node. Cinder attaches the volume to the node and returns connection information which includes target information.</li>
<li>Nova passes the target information for the node to Ironic</li>
<li>Nova calls Ironic to spawn the instance. Ironic prepares the bare metal node to boot from the remote volume which is identified by target information and powers on the bare metal node.</li>
</ol>
<p>In the work flow above, Nova calls Ironic to get/set initiator/target information (4 and 6) and also administrator calls Ironic to set initiator information (1) but currently Ironic has neither those information nor APIs for them.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#pip install rbd-iscsi-client&#x3D;&#x3D;0.1.8 -i https:&#x2F;&#x2F;pypi.tuna.tsinghua.edu.cn&#x2F;simple</span><br><span class="line">#cinder type-create rbd_iscsi</span><br><span class="line">#cinder type-key rbd_iscsi set volume_backend_name&#x3D;rbd_iscsi</span><br><span class="line">#cinder create 100 --display-name iscsi_boot1 --volume-type rbd_iscsi --image-id 3ec7c300-78bc-4d4b-bb1d-aaab4b4c35d7</span><br><span class="line">#cinder create 100 --display-name iscsi_boot2 --volume-type rbd_iscsi</span><br><span class="line">#openstack baremetal node set --storage-interface cinder 5e10c067-c0c6-48be-ac6e-749a70045b97</span><br><span class="line">#openstack baremetal node set --property capabilities&#x3D;iscsi_boot:True 5e10c067-c0c6-48be-ac6e-749a70045b97</span><br><span class="line"></span><br><span class="line">这一步可以理解为注册主机，target中host信息，id名称随便起，最大64bytes</span><br><span class="line">#openstack baremetal volume connector create --node 5e10c067-c0c6-48be-ac6e-749a70045b97 --type iqn --connector-id iqn.2021-04.net.*****.sh.cluster.5e10c067-c0c6-48be-ac6e-749a70045b97</span><br><span class="line">为该裸机分配磁盘 volume</span><br><span class="line">#openstack baremetal volume target create --node 5e10c067-c0c6-48be-ac6e-749a70045b97 --type iscsi --boot-index 0 --volume cfa8c986-7a79-48fd-88a0-aa997d579fbf --property auth_method&#x3D;&quot;CHAP&quot; --property auth_username&#x3D;&quot;admin&quot; --property auth_password&#x3D;&quot;admin&quot;</span><br><span class="line">#openstack baremetal volume target create --node 5e10c067-c0c6-48be-ac6e-749a70045b97 --type iscsi --boot-index 1 --volume 4e4e41e3-fbfb-4737-bd93-863f48470244 --property auth_method&#x3D;&quot;CHAP&quot; --property auth_username&#x3D;&quot;admin&quot; --property auth_password&#x3D;&quot;admin&quot;</span><br><span class="line"></span><br><span class="line">#openstack server create --image 3ec7c300-78bc-4d4b-bb1d-aaab4b4c35d7 --flavor bms.large --nic net-id&#x3D;cb1356ca-e79b-4d7b-ad29-3267e4c2bc41 bm01</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#cinder create 100 --display-name centos7-grub2-iscsi-pwd  --image-id ea4266e4-456e-4fe0-91c9-a8c15dd2d2d6 --volume-type rbd_iscsi</span><br><span class="line">#gwcli</span><br><span class="line">&gt;cd &#x2F;disks&#x2F;</span><br><span class="line">&gt;create iscsi-data image&#x3D;volume-98ebbe5c-a32f-45ee-be04-61c295bcabe4 size&#x3D;100g</span><br><span class="line">&gt;goto hosts</span><br><span class="line">&gt;create iqn.2021-01.net.*****.sh***:server01</span><br><span class="line">&gt;disk add iscsi-data&#x2F;volume-98ebbe5c-a32f-45ee-be04-61c295bcabe4 size&#x3D;100g</span><br></pre></td></tr></table></figure>



<p>常见问题：</p>
<ol>
<li>volume状态是否是available</li>
<li></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#cat &#x2F;data&#x2F;docker&#x2F;volumes&#x2F;ironic_ipxe&#x2F;_data&#x2F;78\:ac\:44\:04\:f1\:a9.conf </span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">#!ipxe</span><br><span class="line"></span><br><span class="line">set attempts:int32 10</span><br><span class="line">set i:int32 0</span><br><span class="line"></span><br><span class="line">goto deploy</span><br><span class="line"></span><br><span class="line">:deploy</span><br><span class="line">imgfree</span><br><span class="line">kernel  selinux&#x3D;0 troubleshoot&#x3D;0 text nofb nomodeset vga&#x3D;normal console&#x3D;tty0 console&#x3D;ttyS0,115200n8 ipa-debug&#x3D;1 BOOTIF&#x3D;$&#123;mac&#125; ipa-api-url&#x3D;http:&#x2F;&#x2F;10.218.105.100:6385 initrd&#x3D;deploy_ramdisk coreos.configdrive&#x3D;0 || goto retry</span><br><span class="line"></span><br><span class="line">initrd  || goto retry</span><br><span class="line">boot</span><br><span class="line"></span><br><span class="line">:retry</span><br><span class="line">iseq $&#123;i&#125; $&#123;attempts&#125; &amp;&amp; goto fail ||</span><br><span class="line">inc i</span><br><span class="line">echo No response, retrying in &#123;i&#125; seconds.</span><br><span class="line">sleep $&#123;i&#125;</span><br><span class="line">goto deploy</span><br><span class="line"></span><br><span class="line">:fail</span><br><span class="line">echo Failed to get a response after $&#123;attempts&#125; attempts</span><br><span class="line">echo Powering off in 30 seconds.</span><br><span class="line">sleep 30</span><br><span class="line">poweroff</span><br><span class="line"></span><br><span class="line">:boot_partition</span><br><span class="line">imgfree</span><br><span class="line">kernel no_kernel root&#x3D;&#123;&#123; ROOT &#125;&#125; ro text nofb nomodeset vga&#x3D;normal console&#x3D;tty0 console&#x3D;ttyS0,115200n8 ipa-debug&#x3D;1 initrd&#x3D;ramdisk || goto boot_partition</span><br><span class="line">initrd no_ramdisk || goto boot_partition</span><br><span class="line">boot</span><br><span class="line"></span><br><span class="line">:boot_ramdisk</span><br><span class="line">imgfree</span><br><span class="line">kernel no_kernel root&#x3D;&#x2F;dev&#x2F;ram0 text nofb nomodeset vga&#x3D;normal console&#x3D;tty0 console&#x3D;ttyS0,115200n8 ipa-debug&#x3D;1  initrd&#x3D;ramdisk || goto boot_ramdisk</span><br><span class="line">initrd no_ramdisk || goto boot_ramdisk</span><br><span class="line">boot</span><br><span class="line"></span><br><span class="line">:boot_iscsi</span><br><span class="line">imgfree</span><br><span class="line">set username iqn.2021-04.net.*****.5e10c067-c0c6-48be-ac6e-749a70045b97</span><br><span class="line">set password Cc6BK5uTbCsH6hCF</span><br><span class="line">set initiator-iqn iqn.2021-04.net.*****.5e10c067-c0c6-48be-ac6e-749a70045b97</span><br><span class="line">sanhook --drive 0x80 iscsi:10.206.79.34::3260:1:iqn.2021-04.net.*****.iscsi-gw:ceph-igw || goto fail_iscsi_retry</span><br><span class="line">set username admin</span><br><span class="line">set password admin</span><br><span class="line">sanhook --drive 0x81 iscsi::::: || goto fail_iscsi_retry</span><br><span class="line">set username iqn.2021-04.net.*****.5e10c067-c0c6-48be-ac6e-749a70045b97</span><br><span class="line">set password Cc6BK5uTbCsH6hCF</span><br><span class="line">sanboot --no-describe || goto fail_iscsi_retry</span><br><span class="line"></span><br><span class="line">:fail_iscsi_retry</span><br><span class="line">echo Failed to attach iSCSI volume(s), retrying in 10 seconds.</span><br><span class="line">sleep 10</span><br><span class="line">goto boot_iscsi</span><br><span class="line"></span><br><span class="line">:boot_whole_disk</span><br></pre></td></tr></table></figure>





<p>bs=16k, iodepth=1</p>
<p>吞吐</p>
<table>
<thead>
<tr>
<th></th>
<th>顺序读</th>
<th>顺序写</th>
<th>随机读</th>
<th>随机写</th>
<th>混合随机读写</th>
</tr>
</thead>
<tbody><tr>
<td>数据云盘sata</td>
<td>246MB</td>
<td>41.8MB</td>
<td>291MB</td>
<td>10.1MB</td>
<td>7799kB/7894kB</td>
</tr>
<tr>
<td>物理盘(sas*2 raid1)</td>
<td>584MB</td>
<td>1418MB/s</td>
<td>127MB</td>
<td>65.4MB</td>
<td>40.2MB/40.1MB</td>
</tr>
</tbody></table>
<p>IOPS</p>
<table>
<thead>
<tr>
<th></th>
<th>顺序读</th>
<th>顺序写</th>
<th>随机读</th>
<th>随机写</th>
<th>混合随机读写</th>
</tr>
</thead>
<tbody><tr>
<td>数据云盘sata</td>
<td>15.0k</td>
<td>2550</td>
<td>17.8k</td>
<td>618</td>
<td>476/481</td>
</tr>
<tr>
<td>物理盘(sas*2 raid1)</td>
<td>35.7k</td>
<td>86.6k</td>
<td>7747</td>
<td>3990</td>
<td>2451/2450</td>
</tr>
</tbody></table>
<p>bs=4k,iodepth=1</p>
<p>吞吐</p>
<table>
<thead>
<tr>
<th></th>
<th>顺序读</th>
<th>顺序写</th>
<th>随机读</th>
<th>随机写</th>
<th>混合随机读写</th>
</tr>
</thead>
<tbody><tr>
<td>数据云盘sata</td>
<td>112MB</td>
<td>14.1MB</td>
<td>93.1MB</td>
<td>2490kB</td>
<td>2212kB/2238kB</td>
</tr>
<tr>
<td>物理盘(sas*2 raid1)</td>
<td>367MB</td>
<td>372MB</td>
<td>21.4MB</td>
<td>15.0MB</td>
<td>7252kB/7263kB</td>
</tr>
</tbody></table>
<p>IOPS</p>
<table>
<thead>
<tr>
<th></th>
<th>顺序读</th>
<th>顺序写</th>
<th>随机读</th>
<th>随机写</th>
<th>混合随机读写</th>
</tr>
</thead>
<tbody><tr>
<td>数据云盘sata</td>
<td>27.3k</td>
<td>3431</td>
<td>22.7k</td>
<td>607</td>
<td>559/565</td>
</tr>
<tr>
<td>物理盘(sas*2 raid1)</td>
<td>89.5k</td>
<td>90.8k</td>
<td>5223</td>
<td>3904</td>
<td>1770/1773</td>
</tr>
</tbody></table>
<p>吞吐 bs=1024k,iodepth=128,size=50G,ioengine=psync </p>
<table>
<thead>
<tr>
<th></th>
<th>顺序读</th>
<th>顺序写</th>
<th>随机读</th>
<th>随机写</th>
<th>混合随机读写</th>
</tr>
</thead>
<tbody><tr>
<td>iSCSI云盘sata 600G</td>
<td>840MB</td>
<td>85MB</td>
<td>830MB</td>
<td>140MB</td>
<td>135MB/140MB</td>
</tr>
<tr>
<td>iSCSI云盘sata 4T</td>
<td>840MB</td>
<td>97MB</td>
<td>870MB</td>
<td>140MB</td>
<td>135MB/140MB</td>
</tr>
<tr>
<td>物理盘(sas*2 raid1) 600G</td>
<td>520MB</td>
<td>2650MB</td>
<td>290MB</td>
<td>150MB</td>
<td>95MB/95MB</td>
</tr>
<tr>
<td>物理盘(sata*1 raid0) 4T</td>
<td>340MB</td>
<td>140MB</td>
<td>100MB</td>
<td>120MB</td>
<td>55MB/60MB</td>
</tr>
<tr>
<td>物理盘(ssd*1 raid0) 800G</td>
<td>280MB</td>
<td>230MB</td>
<td>420MB</td>
<td>350MB</td>
<td>175MB/180MB</td>
</tr>
</tbody></table>
<p>IOPS bs=4k,iodepth=128,size=50G,ioengine=psync</p>
<table>
<thead>
<tr>
<th></th>
<th>顺序读</th>
<th>顺序写</th>
<th>随机读</th>
<th>随机写</th>
<th>混合随机读写</th>
</tr>
</thead>
<tbody><tr>
<td>iSCSI云盘sata 600G</td>
<td>25.9k</td>
<td>2663</td>
<td>20k</td>
<td>799</td>
<td>602/609</td>
</tr>
<tr>
<td>iSCSI云盘sata 4T</td>
<td>26k</td>
<td>3167</td>
<td>25k</td>
<td>828</td>
<td>600/600</td>
</tr>
<tr>
<td>物理盘(sas*2 raid1) 600G</td>
<td>82.0k</td>
<td>92.3k</td>
<td>901</td>
<td>1232</td>
<td>685/694</td>
</tr>
<tr>
<td>物理盘(sata*1 raid0) 4T</td>
<td>5.8k</td>
<td>7k</td>
<td>327</td>
<td>276</td>
<td>142/148</td>
</tr>
<tr>
<td>物理盘(ssd*1 raid0) 800G</td>
<td>47.9k</td>
<td>6k</td>
<td>46.4k</td>
<td>39.6k</td>
<td>20.2k/20.2k</td>
</tr>
</tbody></table>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.kubestack.cn/2021/05/07/openstack-%E8%A3%B8%E9%87%91%E5%B1%9Eironic%E5%88%9B%E5%BB%BA%E5%8F%8A%E8%B0%83%E5%BA%A6-3/" data-id="ckssanb430009to16hmlb36nd" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openstack/" rel="tag">openstack</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-openstack-裸金属ironic创建及调度-2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/04/25/openstack-%E8%A3%B8%E9%87%91%E5%B1%9Eironic%E5%88%9B%E5%BB%BA%E5%8F%8A%E8%B0%83%E5%BA%A6-2/" class="article-date">
  <time datetime="2021-04-25T07:02:40.000Z" itemprop="datePublished">2021-04-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/04/25/openstack-%E8%A3%B8%E9%87%91%E5%B1%9Eironic%E5%88%9B%E5%BB%BA%E5%8F%8A%E8%B0%83%E5%BA%A6-2/">openstack-裸金属ironic创建及调度-2</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="创建裸金属实例Flavor"><a href="#创建裸金属实例Flavor" class="headerlink" title="创建裸金属实例Flavor"></a>创建裸金属实例Flavor</h2><p><strong>官方文档</strong>：<a target="_blank" rel="noopener" href="https://docs.openstack.org/ironic/latest/install/configure-nova-flavors.html">https://docs.openstack.org/ironic/latest/install/configure-nova-flavors.html</a></p>
<p>在 Queen 版本中，Ironic 项目新增 Trait API，节点的 traits 信息可以注册到计算服务的 Placement API 中，用于创建虚拟机时的调度。添加 Trait API 后，注册到 Ironic 的裸机也可以通过 Trait API 注册到 Placement 资源清单中，最终支持裸机的部署调度。</p>
<p>本文我们实践通过 Placement 来完成裸机的调度，通过 Resource Class 来标识 ironic node 的资源类型，通过 Resource Traits 来标识 ironic node 的特征，还可以通过 resources:VCPU=0、resources:MEMORY_MB=0、resources:DISK_GB=0 来 disable scheduling。</p>
<ul>
<li><strong>创建 Flavor</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">openstack flavor create --ram 262144 --vcpus 40 --disk 600 bms.test </span><br><span class="line">openstack flavor set --property resources:CUSTOM_BAREMETAL&#x3D;1 bms.test</span><br><span class="line">openstack flavor set --property resources:VCPU&#x3D;0 bms.test </span><br><span class="line">openstack flavor set --property resources:MEMORY_MB&#x3D;0 bms.test </span><br><span class="line">openstack flavor set --property resources:DISK_GB&#x3D;0 bms.test</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>验证，获取 Placement 候选人</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack allocation candidate list --resource VCPU&#x3D;40 --resource DISK_GB&#x3D;600 --resource MEMORY_MB&#x3D;262144 --resource CUSTOM_BAREMETAL&#x3D;1</span><br><span class="line">+---+-----------------------------------------------------------+--------------------------------------+-------------------------------------------------------------------+------------------------------+</span><br><span class="line">| # | allocation                                                | resource provider                    | inventory used&#x2F;capacity                                           | traits                       |</span><br><span class="line">+---+-----------------------------------------------------------+--------------------------------------+-------------------------------------------------------------------+------------------------------+</span><br><span class="line">| 1 | MEMORY_MB&#x3D;8192,VCPU&#x3D;2,DISK_GB&#x3D;100,CUSTOM_BAREMETAL_TEST&#x3D;1 | e322f49a-ad50-468d-a031-29bde068c290 | VCPU&#x3D;0&#x2F;2,MEMORY_MB&#x3D;0&#x2F;8192,DISK_GB&#x3D;0&#x2F;100,CUSTOM_BAREMETAL_TEST&#x3D;0&#x2F;1 | HW_CPU_X86_VMX,CUSTOM_TRAIT1 |</span><br><span class="line">+---+-----------------------------------------------------------+--------------------------------------+--------</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@17471e0f8de8 sh1]# openstack allocation candidate list   --resource CUSTOM_BAREMETAL&#x3D;1                                                             </span><br><span class="line">+---+--------------------+--------------------------------------+-------------------------+---------------------------------------------+</span><br><span class="line">| # | allocation         | resource provider                    | inventory used&#x2F;capacity | traits                                      |</span><br><span class="line">+---+--------------------+--------------------------------------+-------------------------+---------------------------------------------+</span><br><span class="line">| 1 | CUSTOM_BAREMETAL&#x3D;1 | 5e10c067-c0c6-48be-ac6e-749a70045b97 | CUSTOM_BAREMETAL&#x3D;0&#x2F;1    | HW_CPU_X86_VMX,COMPUTE_NET_ATTACH_INTERFACE |</span><br><span class="line">+---+--------------------+--------------------------------------+-------------------------+---------------------------------------------+</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.kubestack.cn/2021/04/25/openstack-%E8%A3%B8%E9%87%91%E5%B1%9Eironic%E5%88%9B%E5%BB%BA%E5%8F%8A%E8%B0%83%E5%BA%A6-2/" data-id="ckssanb410008to165fjafrtb" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openstack/" rel="tag">openstack</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-openstack-裸金属ironic创建及调度-1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/04/25/openstack-%E8%A3%B8%E9%87%91%E5%B1%9Eironic%E5%88%9B%E5%BB%BA%E5%8F%8A%E8%B0%83%E5%BA%A6-1/" class="article-date">
  <time datetime="2021-04-25T06:25:29.000Z" itemprop="datePublished">2021-04-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/04/25/openstack-%E8%A3%B8%E9%87%91%E5%B1%9Eironic%E5%88%9B%E5%BB%BA%E5%8F%8A%E8%B0%83%E5%BA%A6-1/">openstack-裸金属ironic创建及调度-1</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="注册裸机节点"><a href="#注册裸机节点" class="headerlink" title="注册裸机节点"></a>注册裸机节点</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">#openstack baremetal node create --driver ipmi --name BM01</span><br><span class="line">+------------------------+--------------------------------------+</span><br><span class="line">| Field                  | Value                                |</span><br><span class="line">+------------------------+--------------------------------------+</span><br><span class="line">| allocation_uuid        | None                                 |</span><br><span class="line">| automated_clean        | None                                 |</span><br><span class="line">| bios_interface         | no-bios                              |</span><br><span class="line">| boot_interface         | pxe                                  |</span><br><span class="line">| chassis_uuid           | None                                 |</span><br><span class="line">| clean_step             | &#123;&#125;                                   |</span><br><span class="line">| conductor              | openstack07.control    |</span><br><span class="line">| conductor_group        |                                      |</span><br><span class="line">| console_enabled        | False                                |</span><br><span class="line">| console_interface      | ipmitool-socat                       |</span><br><span class="line">| created_at             | 2021-04-25T06:27:44+00:00            |</span><br><span class="line">| deploy_interface       | iscsi                                |</span><br><span class="line">| deploy_step            | &#123;&#125;                                   |</span><br><span class="line">| description            | None                                 |</span><br><span class="line">| driver                 | ipmi                                 |</span><br><span class="line">| driver_info            | &#123;&#125;                                   |</span><br><span class="line">| driver_internal_info   | &#123;&#125;                                   |</span><br><span class="line">| extra                  | &#123;&#125;                                   |</span><br><span class="line">| fault                  | None                                 |</span><br><span class="line">| inspect_interface      | no-inspect                           |</span><br><span class="line">| inspection_finished_at | None                                 |</span><br><span class="line">| inspection_started_at  | None                                 |</span><br><span class="line">| instance_info          | &#123;&#125;                                   |</span><br><span class="line">| instance_uuid          | None                                 |</span><br><span class="line">| last_error             | None                                 |</span><br><span class="line">| maintenance            | False                                |</span><br><span class="line">| maintenance_reason     | None                                 |</span><br><span class="line">| management_interface   | ipmitool                             |</span><br><span class="line">| name                   | BM01                                 |</span><br><span class="line">| network_interface      | neutron                              |</span><br><span class="line">| owner                  | None                                 |</span><br><span class="line">| power_interface        | ipmitool                             |</span><br><span class="line">| power_state            | None                                 |</span><br><span class="line">| properties             | &#123;&#125;                                   |</span><br><span class="line">| protected              | False                                |</span><br><span class="line">| protected_reason       | None                                 |</span><br><span class="line">| provision_state        | enroll                               |</span><br><span class="line">| provision_updated_at   | None                                 |</span><br><span class="line">| raid_config            | &#123;&#125;                                   |</span><br><span class="line">| raid_interface         | no-raid                              |</span><br><span class="line">| rescue_interface       | no-rescue                            |</span><br><span class="line">| reservation            | None                                 |</span><br><span class="line">| resource_class         | None                                 |</span><br><span class="line">| storage_interface      | noop                                 |</span><br><span class="line">| target_power_state     | None                                 |</span><br><span class="line">| target_provision_state | None                                 |</span><br><span class="line">| target_raid_config     | &#123;&#125;                                   |</span><br><span class="line">| traits                 | []                                   |</span><br><span class="line">| updated_at             | None                                 |</span><br><span class="line">| uuid                   | 5e10c067-c0c6-48be-ac6e-749a70045b97 |</span><br><span class="line">| vendor_interface       | ipmitool                             |</span><br><span class="line">+------------------------+--------------------------------------+</span><br></pre></td></tr></table></figure>



<p>当前许多 ironic node info 都是 None，需要后续继续更新。</p>
<ul>
<li><strong>设置部署接口类型，现在可支持 iSCSI、Direct、Ansible 等类型，每种类型都有不同的行为模型，可根据实际情况选择，这里我们选择direct 、不使用（占用 Provisioning Network 的带宽）的 iSCS 类型</strong>。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openstack baremetal  node set 5e10c067-c0c6-48be-ac6e-749a70045b97 \</span><br><span class="line">    --deploy-interface direct </span><br></pre></td></tr></table></figure>

<ul>
<li><strong>设置 driver_info，这里即 IPMI info，主要是提供 IPMI 的登录账户信息</strong>。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">openstack baremetal node set 5e10c067-c0c6-48be-ac6e-749a70045b97 \</span><br><span class="line">    --driver-info ipmi_username&#x3D;admin \</span><br><span class="line">    --driver-info ipmi_password&#x3D;admin \</span><br><span class="line">    --driver-info ipmi_address&#x3D;172.18.22.106 \</span><br><span class="line">    --driver-info ipmi_port&#x3D;623</span><br></pre></td></tr></table></figure>

<p><strong>NOTE</strong>：<a target="_blank" rel="noopener" href="https://docs.openstack.org/ironic/rocky/admin/drivers/ipmitool.html">IPMI Driver 官方文档</a></p>
<ul>
<li><strong>设置 Deploy Images，通过 RAMDisk 的方式启动</strong>。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">openstack image list</span><br><span class="line"></span><br><span class="line">openstack baremetal node set 5e10c067-c0c6-48be-ac6e-749a70045b97 \</span><br><span class="line">    --driver-info deploy_kernel&#x3D;07852c3c-f4b4-43ab-b6b3-aeafe12c07d4 \</span><br><span class="line">    --driver-info deploy_ramdisk&#x3D;e3429cf3-8fed-4ff8-afb0-50056aacc8f0</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>设置 Provisioning/Cleaning Network</strong>。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">neutron net-create ironic_deploy --shared  --provider:network_type flat --provider:physical_network physnet1</span><br><span class="line"></span><br><span class="line">neutron subnet-create --name flat-subnet --gateway 192.168.99.1 --dns-nameserver 8.8.8.8  --allocation-pool start&#x3D;192.168.99.120,end&#x3D;192.168.99.250  ironic_deploy 192.168.99.0&#x2F;24</span><br><span class="line"></span><br><span class="line">openstack baremetal node set 5e10c067-c0c6-48be-ac6e-749a70045b97 \</span><br><span class="line">    --driver-info cleaning_network&#x3D;7fa970fd-60c7-4f7e-83a2-cd611470dfc6 \</span><br><span class="line">    --driver-info provisioning_network&#x3D;7fa970fd-60c7-4f7e-83a2-cd611470dfc6</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>设置 ironic node 的 PXE 网卡 MAC 地址，在 Provisioning Network 中通过这个 MAC 地址来为其分配 IP 地址</strong>。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openstack baremetal port create 78:ac:44:04:f1:a9 --node 5e10c067-c0c6-48be-ac6e-749a70045b97</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>NOTE</strong>：部署裸金属实例成功之后 PXE 网卡的 MAC 地址会被绑定到对应的 Tenant Network Port。</p>
<ul>
<li><strong>为 ironic node 设置 Placement 筛选候选人的 Resource Class 类型，nova-compute for Ironic 会自动为其创建 Placement Resource Provider</strong>。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ openstack baremetal node set 5e10c067-c0c6-48be-ac6e-749a70045b97 --resource-class BAREMETAL</span><br><span class="line"></span><br><span class="line">$ openstack resource provider list</span><br><span class="line">+--------------------------------------+--------------------------------------+------------+--------------------------------------+----------------------+</span><br><span class="line">| uuid                                 | name                                 | generation | root_provider_uuid                   | parent_provider_uuid |</span><br><span class="line">+--------------------------------------+--------------------------------------+------------+--------------------------------------+----------------------+</span><br><span class="line">| f00d6063-1253-4103-8f4d-899ea700936f | openstack08.control    |          5 | f00d6063-1253-4103-8f4d-899ea700936f | None                 |</span><br><span class="line">| 0cbb35fe-44b7-4fe7-a93f-41ffacaf6a0a | openstack07.control    |          5 | 0cbb35fe-44b7-4fe7-a93f-41ffacaf6a0a | None                 |</span><br><span class="line">| 9ee63716-854f-4554-8211-9de6516e3aa3 | 9ee63716-854f-4554-8211-9de6516e3aa3 |          3 | 9ee63716-854f-4554-8211-9de6516e3aa3 | None                 |</span><br><span class="line">| 4a22be4a-fd35-43d8-842e-6ac7db30bd4e | 4a22be4a-fd35-43d8-842e-6ac7db30bd4e |          0 | 4a22be4a-fd35-43d8-842e-6ac7db30bd4e | None                 |</span><br><span class="line">+--------------------------------------+--------------------------------------+------------+--------------------------------------+----------------------+</span><br><span class="line"></span><br><span class="line">$ openstack resource provider inventory list 5e10c067-c0c6-48be-ac6e-749a70045b97  </span><br><span class="line">+------------------+------------------+----------+----------+----------+-----------+-------+</span><br><span class="line">| resource_class   | allocation_ratio | min_unit | max_unit | reserved | step_size | total |</span><br><span class="line">+------------------+------------------+----------+----------+----------+-----------+-------+</span><br><span class="line">| CUSTOM_BAREMETAL |              1.0 |        1 |        1 |        1 |         1 |     1 |</span><br><span class="line">+------------------+------------------+----------+----------+----------+-----------+-------+</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>为 ironic node 设置 Placement 筛选候选人的 Resource Traits 标签</strong>。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">openstack baremetal node add trait 5e10c067-c0c6-48be-ac6e-749a70045b97 \</span><br><span class="line">   HW_CPU_X86_VMX</span><br><span class="line"></span><br><span class="line">[root@controller ~]# openstack resource provider trait list e322f49a-ad50-468d-a031-29bde068c290</span><br><span class="line">+----------------+</span><br><span class="line">| name           |</span><br><span class="line">+----------------+</span><br><span class="line">| HW_CPU_X86_VMX |</span><br><span class="line">| CUSTOM_TRAIT1  |</span><br><span class="line">+----------------+</span><br></pre></td></tr></table></figure>

<p><strong>NOTE</strong>：这个操作需要较高的 Placement API 版本 &lt;= 1.17</p>
<ul>
<li><strong>设置 ironic node 的基础资源信息，作为 Placement 筛选候选人的参数因子</strong>。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">openstack baremetal node set 5e10c067-c0c6-48be-ac6e-749a70045b97 \</span><br><span class="line">--property cpus&#x3D;40 \</span><br><span class="line">--property memory_mb&#x3D;262144 \</span><br><span class="line">--property local_gb&#x3D;600 </span><br></pre></td></tr></table></figure>

<ul>
<li><strong>如果裸机服务器设定的是 UEFI，那么需要设置 ironic node 的 boot mode</strong>。(传统bios请忽略！！！)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack baremetal node set 5e10c067-c0c6-48be-ac6e-749a70045b97 --property capabilities&#x3D;&#39;boot_mode:uefi&#39;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>验证上述录入的 ironic node infos 是否合规</strong>。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ openstack baremetal node validate e322f49a-ad50-468d-a031-29bde068c290</span><br><span class="line">+------------+--------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Interface  | Result | Reason                                                                                                                                                                                                                                                                    |</span><br><span class="line">+------------+--------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| bios       | False  | Driver ipmi does not support bios (disabled or not implemented).                                                                                                                                                                                                          |</span><br><span class="line">| boot       | False  | Cannot validate image information for node e322f49a-ad50-468d-a031-29bde068c290 because one or more parameters are missing from its instance_info and insufficent information is present to boot from a remote volume. Missing are: [&#39;ramdisk&#39;, &#39;kernel&#39;, &#39;image_source&#39;] |</span><br><span class="line">| console    | False  | Missing &#39;ipmi_terminal_port&#39; parameter in node&#39;s driver_info.                                                                                                                                                                                                             |</span><br><span class="line">| deploy     | False  | Cannot validate image information for node e322f49a-ad50-468d-a031-29bde068c290 because one or more parameters are missing from its instance_info and insufficent information is present to boot from a remote volume. Missing are: [&#39;ramdisk&#39;, &#39;kernel&#39;, &#39;image_source&#39;] |</span><br><span class="line">| inspect    | True   |                                                                                                                                                                                                                                                                           |</span><br><span class="line">| management | True   |                                                                                                                                                                                                                                                                           |</span><br><span class="line">| network    | True   |                                                                                                                                                                                                                                                                           |</span><br><span class="line">| power      | True   |                                                                                                                                                                                                                                                                           |</span><br><span class="line">| raid       | True   |                                                                                                                                                                                                                                                                           |</span><br><span class="line">| rescue     | False  | Driver ipmi does not support rescue (disabled or not implemented).                                                                                                                                                                                                        |</span><br><span class="line">| storage    | True   |                                                                                                                                                                                                                                                                           |</span><br><span class="line">+------------+--------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>

<p><strong>NOTE</strong>：这里出现了 4 个 False，但没有致命影响，其中 bios、console 是因为我们没有提供相应的驱动，属于可选项。而 boot、deploy 在 Nova Driver for Ironic 的环境中是无法通过验证的。</p>
<ul>
<li><strong>验证 ironic node 是否能够被纳管</strong>。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># To move a node from enroll to manageable provision state</span><br><span class="line">$ openstack baremetal node manage 5e10c067-c0c6-48be-ac6e-749a70045b97</span><br><span class="line">$ openstack baremetal node show 5e10c067-c0c6-48be-ac6e-749a70045b97 | grep provision_state</span><br><span class="line">| provision_state        | manageable  </span><br><span class="line">                                                                                                                                                                                                                                                                                                                                                        </span><br><span class="line"># To move a node from manageable to available provision state</span><br><span class="line">$ openstack baremetal node provide 5e10c067-c0c6-48be-ac6e-749a70045b97</span><br><span class="line">$ [root@controller ~]# openstack baremetal node show 5e10c067-c0c6-48be-ac6e-749a70045b97 | grep provision_state</span><br><span class="line">| provision_state        | available</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>查看当前的 ironic node 状态</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack baremetal node show 5e10c067-c0c6-48be-ac6e-749a70045b97</span><br><span class="line">+------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Field                  | Value                                                                                                                                                                                                                                                                                                                                                    |</span><br><span class="line">+------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| allocation_uuid        | None                                                                                                                                                                                                                                                                                                                                                     |</span><br><span class="line">| automated_clean        | None                                                                                                                                                                                                                                                                                                                                                     |</span><br><span class="line">| bios_interface         | no-bios                                                                                                                                                                                                                                                                                                                                                  |</span><br><span class="line">| boot_interface         | pxe                                                                                                                                                                                                                                                                                                                                                      |</span><br><span class="line">| chassis_uuid           | None                                                                                                                                                                                                                                                                                                                                                     |</span><br><span class="line">| clean_step             | &#123;&#125;                                                                                                                                                                                                                                                                                                                                                       |</span><br><span class="line">| conductor              | openstack08.control                                                                                                                                                                                                                                                                                                                        |</span><br><span class="line">| conductor_group        |                                                                                                                                                                                                                                                                                                                                                          |</span><br><span class="line">| console_enabled        | False                                                                                                                                                                                                                                                                                                                                                    |</span><br><span class="line">| console_interface      | ipmitool-socat                                                                                                                                                                                                                                                                                                                                           |</span><br><span class="line">| created_at             | 2021-04-25T10:13:09+00:00                                                                                                                                                                                                                                                                                                                                |</span><br><span class="line">| deploy_interface       | direct                                                                                                                                                                                                                                                                                                                                                   |</span><br><span class="line">| deploy_step            | &#123;&#125;                                                                                                                                                                                                                                                                                                                                                       |</span><br><span class="line">| description            | None                                                                                                                                                                                                                                                                                                                                                     |</span><br><span class="line">| driver                 | ipmi                                                                                                                                                                                                                                                                                                                                                     |</span><br><span class="line">| driver_info            | &#123;&#39;ipmi_port&#39;: 623, &#39;ipmi_username&#39;: &#39;admin&#39;, &#39;deploy_kernel&#39;: &#39;07852c3c-f4b4-43ab-b6b3-aeafe12c07d4&#39;, &#39;ipmi_address&#39;: &#39;172.18.22.106&#39;, &#39;deploy_ramdisk&#39;: &#39;e3429cf3-8fed-4ff8-afb0-50056aacc8f0&#39;, &#39;ipmi_password&#39;: &#39;******&#39;, &#39;provisioning_network&#39;: &#39;7fa970fd-60c7-4f7e-83a2-cd611470dfc6&#39;, &#39;cleaning_network&#39;: &#39;7fa970fd-60c7-4f7e-83a2-cd611470dfc6&#39;&#125; |</span><br><span class="line">| driver_internal_info   | &#123;&#125;                                                                                                                                                                                                                                                                                                                                                       |</span><br><span class="line">| extra                  | &#123;&#125;                                                                                                                                                                                                                                                                                                                                                       |</span><br><span class="line">| fault                  | None                                                                                                                                                                                                                                                                                                                                                     |</span><br><span class="line">| inspect_interface      | no-inspect                                                                                                                                                                                                                                                                                                                                               |</span><br><span class="line">| inspection_finished_at | None                                                                                                                                                                                                                                                                                                                                                     |</span><br><span class="line">| inspection_started_at  | None                                                                                                                                                                                                                                                                                                                                                     |</span><br><span class="line">| instance_info          | &#123;&#125;                                                                                                                                                                                                                                                                                                                                                       |</span><br><span class="line">| instance_uuid          | None                                                                                                                                                                                                                                                                                                                                                     |</span><br><span class="line">| last_error             | None                                                                                                                                                                                                                                                                                                                                                     |</span><br><span class="line">| maintenance            | False                                                                                                                                                                                                                                                                                                                                                    |</span><br><span class="line">| maintenance_reason     | None                                                                                                                                                                                                                                                                                                                                                     |</span><br><span class="line">| management_interface   | ipmitool                                                                                                                                                                                                                                                                                                                                                 |</span><br><span class="line">| name                   | BM01                                                                                                                                                                                                                                                                                                                                                     |</span><br><span class="line">| network_interface      | neutron                                                                                                                                                                                                                                                                                                                                                  |</span><br><span class="line">| owner                  | None                                                                                                                                                                                                                                                                                                                                                     |</span><br><span class="line">| power_interface        | ipmitool                                                                                                                                                                                                                                                                                                                                                 |</span><br><span class="line">| power_state            | power on                                                                                                                                                                                                                                                                                                                                                 |</span><br><span class="line">| properties             | &#123;&#125;                                                                                                                                                                                                                                                                                                                                                       |</span><br><span class="line">| protected              | False                                                                                                                                                                                                                                                                                                                                                    |</span><br><span class="line">| protected_reason       | None                                                                                                                                                                                                                                                                                                                                                     |</span><br><span class="line">| provision_state        | available                                                                                                                                                                                                                                                                                                                                                |</span><br><span class="line">| provision_updated_at   | 2021-04-25T10:30:35+00:00                                                                                                                                                                                                                                                                                                                                |</span><br><span class="line">| raid_config            | &#123;&#125;                                                                                                                                                                                                                                                                                                                                                       |</span><br><span class="line">| raid_interface         | no-raid                                                                                                                                                                                                                                                                                                                                                  |</span><br><span class="line">| rescue_interface       | no-rescue                                                                                                                                                                                                                                                                                                                                                |</span><br><span class="line">| reservation            | None                                                                                                                                                                                                                                                                                                                                                     |</span><br><span class="line">| resource_class         | BAREMETAL                                                                                                                                                                                                                                                                                                                                                |</span><br><span class="line">| storage_interface      | noop                                                                                                                                                                                                                                                                                                                                                     |</span><br><span class="line">| target_power_state     | None                                                                                                                                                                                                                                                                                                                                                     |</span><br><span class="line">| target_provision_state | None                                                                                                                                                                                                                                                                                                                                                     |</span><br><span class="line">| target_raid_config     | &#123;&#125;                                                                                                                                                                                                                                                                                                                                                       |</span><br><span class="line">| traits                 | [&#39;HW_CPU_X86_VMX&#39;]                                                                                                                                                                                                                                                                                                                                       |</span><br><span class="line">| updated_at             | 2021-04-25T10:30:35+00:00                                                                                                                                                                                                                                                                                                                                |</span><br><span class="line">| uuid                   | 5e10c067-c0c6-48be-ac6e-749a70045b97                                                                                                                                                                                                                                                                                                                     |</span><br><span class="line">| vendor_interface       | ipmitool                                                                                                                                                                                                                                                                                                                                                 |</span><br><span class="line">+------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">[root@17471e0f8de8 sh1]# </span><br></pre></td></tr></table></figure>

<ul>
<li><strong>验证，自动添加了 Ironic Neutron Agent</strong>。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@baremetal ~]# openstack network agent list</span><br><span class="line">2ecbcf17-b11b-4e6a-87b5-349dde0fcee3 | Baremetal Node | 5e10c067-c0c6-48be-ac6e-749a70045b97 | None              | :-)   | UP    | ironic-neutron-agent </span><br></pre></td></tr></table></figure>



<p>参考：<a target="_blank" rel="noopener" href="https://docs.openstack.org/ironic/stein/admin/boot-from-volume.html#storage-interface">https://docs.openstack.org/ironic/stein/admin/boot-from-volume.html#storage-interface</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.kubestack.cn/2021/04/25/openstack-%E8%A3%B8%E9%87%91%E5%B1%9Eironic%E5%88%9B%E5%BB%BA%E5%8F%8A%E8%B0%83%E5%BA%A6-1/" data-id="ckssanb4v000xto163vnogqup" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openstack/" rel="tag">openstack</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-openstack-裸金属ironic整理-8" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/04/22/openstack-%E8%A3%B8%E9%87%91%E5%B1%9Eironic%E6%95%B4%E7%90%86-8/" class="article-date">
  <time datetime="2021-04-22T11:36:24.000Z" itemprop="datePublished">2021-04-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/04/22/openstack-%E8%A3%B8%E9%87%91%E5%B1%9Eironic%E6%95%B4%E7%90%86-8/">openstack-裸金属ironic整理-8</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>裸金属存储架构</p>
<p>存储</p>
<p><img src="http://www.taocloudx.com/uploads/200629/1-200629144A0300.png" alt="img"></p>
<p><img src="https://img-blog.csdn.net/20180314191409617" alt="img"></p>
<p>ceph iscsi 集群架构</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/68a05d45effae6d6610b8013aa24c8f4.png" alt="image"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.kubestack.cn/2021/04/22/openstack-%E8%A3%B8%E9%87%91%E5%B1%9Eironic%E6%95%B4%E7%90%86-8/" data-id="ckssanb4a000pto1639u8crn1" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openstack/" rel="tag">openstack</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-openstack-裸金属ironic整理-7" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/04/22/openstack-%E8%A3%B8%E9%87%91%E5%B1%9Eironic%E6%95%B4%E7%90%86-7/" class="article-date">
  <time datetime="2021-04-22T11:36:20.000Z" itemprop="datePublished">2021-04-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/04/22/openstack-%E8%A3%B8%E9%87%91%E5%B1%9Eironic%E6%95%B4%E7%90%86-7/">openstack-裸金属ironic整理-7</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="PXE概述"><a href="#PXE概述" class="headerlink" title="PXE概述"></a>PXE概述</h2><p>PXE 是描述客户端-服务器与网络引导软件交互的行业标准，并使用 DHCP 和 TFTP 协议。本指南介绍了一种使用 PXE 环境安装 Clear Linux OS 的方法。</p>
<p>名为 <a target="_blank" rel="noopener" href="http://ipxe.org/">iPXE</a> 的 PXE 扩展新增了对 HTTP、iSCSI、AoE 和 FCoE 等协议的支持。iPXE 支持在没有内置 PXE 支持的计算机上使用网络引导。</p>
<p>要通过 iPXE 安装 Clear Linux OS，必须创建一个 PXE 客户端。图 1 描述了 PXE 服务器和 PXE 客户端之间的信息流。</p>
<p><img src="https://docs.01.org/clearlinux/latest/zh_CN/_images/network-boot-flow.png" alt="PXE information flow"></p>
<p>看一下 ironic dnsmasq配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#cat &#x2F;etc&#x2F;kolla&#x2F;ironic-dnsmasq&#x2F;dnsmasq.conf</span><br><span class="line"></span><br><span class="line">port&#x3D;0</span><br><span class="line">interface&#x3D;ironic_port</span><br><span class="line">dhcp-range&#x3D;172.66.0.200,172.66.0.250</span><br><span class="line">dhcp-option&#x3D;option:tftp-server,172.66.0.235</span><br><span class="line">dhcp-option&#x3D;option:server-ip-address,172.66.0.235</span><br><span class="line">bind-interfaces</span><br><span class="line">dhcp-sequential-ip</span><br><span class="line">dhcp-option&#x3D;210,&#x2F;tftpboot&#x2F;</span><br><span class="line">dhcp-match&#x3D;ipxe,175</span><br><span class="line">dhcp-match&#x3D;set:efi,option:client-arch,7</span><br><span class="line">dhcp-match&#x3D;set:efi,option:client-arch,9</span><br><span class="line"># Client is already running iPXE; move to next stage of chainloading</span><br><span class="line">dhcp-option&#x3D;tag:ipxe,option:bootfile-name,http:&#x2F;&#x2F;10.145.69.8:8089&#x2F;inspector.ipxe</span><br><span class="line"># Client is PXE booting over EFI without iPXE ROM,</span><br><span class="line"># send EFI version of iPXE chainloader</span><br><span class="line">dhcp-option&#x3D;tag:efi,tag:!ipxe,option:bootfile-name,ipxe.efi</span><br><span class="line">dhcp-option&#x3D;option:bootfile-name,pxelinux.0</span><br><span class="line">dhcp-hostsdir&#x3D;&#x2F;etc&#x2F;dnsmasq&#x2F;dhcp-hostsdir</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.kubestack.cn/2021/04/22/openstack-%E8%A3%B8%E9%87%91%E5%B1%9Eironic%E6%95%B4%E7%90%86-7/" data-id="ckssanb48000lto163o560lfv" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openstack/" rel="tag">openstack</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-openstack-裸金属ironic整理-6" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/04/22/openstack-%E8%A3%B8%E9%87%91%E5%B1%9Eironic%E6%95%B4%E7%90%86-6/" class="article-date">
  <time datetime="2021-04-22T11:36:16.000Z" itemprop="datePublished">2021-04-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/04/22/openstack-%E8%A3%B8%E9%87%91%E5%B1%9Eironic%E6%95%B4%E7%90%86-6/">openstack-裸金属ironic整理-6</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Direct-Deploy-UML"><a href="#Direct-Deploy-UML" class="headerlink" title="Direct Deploy UML"></a>Direct Deploy UML</h2><p>*With direct deploy interface, the deploy ramdisk fetches the image from an HTTP location. It can be an object storage (swift or RadosGW) temporary URL or a user-provided HTTP URL. The deploy ramdisk then copies the image to the target disk. *</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openstack baremetal node create --driver ipmi --deploy-interface direct</span><br><span class="line">openstack baremetal node set &lt;NODE&gt; --deploy-interface direct</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20190506160607912.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9pcy1jbG91ZC5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/20190507152743937.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9pcy1jbG91ZC5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<ol>
<li>加入 Provision Network。</li>
<li>重启裸机。</li>
<li>IPA 通过 lookup 从 Ironic Conductor 取得它对应的 ironic_node_uuid。</li>
<li>IPA 通过 Heartbeat 与 Ironic 通信，驱动部署流程触发 ironic-conductor 发送 prepare_image 命令到 IPA，让 IPA 直接<strong>（Direct）</strong>下载并注入用户镜像到本地磁盘。写镜像是一个耗时较长的动作，通常 300GB 大小的镜像需要十分钟左右。</li>
<li>ironic-conductor 收到 Heartbeat 消息后（从 ironic-api 过来的 RPC 消息），根据当前状态的不同有相应的处理。第一个 Heartbeat 消息会触发 ironic-conductor 下发 prepare_image 到 IPA，以后的 Heartbeat 消息会触发 ironic-conductor 查询 IPA 上的 command status，它的目的是要监控 prepare_image 等 command 是否还在运行中。一旦 command status 显示命令结束。就会继续下一步部署操作，包括设置物理服务器从磁盘启动、关机、切换网络、开机。知道部署流程结束。</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.kubestack.cn/2021/04/22/openstack-%E8%A3%B8%E9%87%91%E5%B1%9Eironic%E6%95%B4%E7%90%86-6/" data-id="ckssanb47000jto16byid9kef" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openstack/" rel="tag">openstack</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/4/">&amp;laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><a class="extend next" rel="next" href="/page/6/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ELK/" rel="tag">ELK</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/django/" rel="tag">django</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/elastic/" rel="tag">elastic</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/etcd/" rel="tag">etcd</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go/" rel="tag">go</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grpc/" rel="tag">grpc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iptables/" rel="tag">iptables</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kata/" rel="tag">kata</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kube-ovn/" rel="tag">kube-ovn</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kubernetes/" rel="tag">kubernetes</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mariadb/" rel="tag">mariadb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openstack/" rel="tag">openstack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spdk/" rel="tag">spdk</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/" rel="tag">云计算</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%85%B3%E4%BA%8E%E4%BD%9C%E8%80%85/" rel="tag">关于作者</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" rel="tag">大数据</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" rel="tag">微服务</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E5%AD%A6%E7%94%9F%E6%B4%BB/" rel="tag">文学生活</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BC%8F%E6%B4%9E%E5%AE%89%E5%85%A8/" rel="tag">漏洞安全</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F/" rel="tag">监控系统</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%99%9A%E6%8B%9F%E5%8C%96/" rel="tag">虚拟化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" rel="tag">面试题</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/ELK/" style="font-size: 10px;">ELK</a> <a href="/tags/Linux/" style="font-size: 17.27px;">Linux</a> <a href="/tags/django/" style="font-size: 10px;">django</a> <a href="/tags/docker/" style="font-size: 13.64px;">docker</a> <a href="/tags/elastic/" style="font-size: 10px;">elastic</a> <a href="/tags/etcd/" style="font-size: 10px;">etcd</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/go/" style="font-size: 19.09px;">go</a> <a href="/tags/grpc/" style="font-size: 10.91px;">grpc</a> <a href="/tags/iptables/" style="font-size: 10px;">iptables</a> <a href="/tags/kata/" style="font-size: 14.55px;">kata</a> <a href="/tags/kube-ovn/" style="font-size: 10px;">kube-ovn</a> <a href="/tags/kubernetes/" style="font-size: 18.18px;">kubernetes</a> <a href="/tags/linux/" style="font-size: 16.36px;">linux</a> <a href="/tags/mariadb/" style="font-size: 10px;">mariadb</a> <a href="/tags/mysql/" style="font-size: 13.64px;">mysql</a> <a href="/tags/openstack/" style="font-size: 20px;">openstack</a> <a href="/tags/python/" style="font-size: 11.82px;">python</a> <a href="/tags/spdk/" style="font-size: 12.73px;">spdk</a> <a href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/" style="font-size: 10px;">云计算</a> <a href="/tags/%E5%85%B3%E4%BA%8E%E4%BD%9C%E8%80%85/" style="font-size: 10px;">关于作者</a> <a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" style="font-size: 10px;">大数据</a> <a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" style="font-size: 10px;">微服务</a> <a href="/tags/%E6%96%87%E5%AD%A6%E7%94%9F%E6%B4%BB/" style="font-size: 10px;">文学生活</a> <a href="/tags/%E6%BC%8F%E6%B4%9E%E5%AE%89%E5%85%A8/" style="font-size: 10px;">漏洞安全</a> <a href="/tags/%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F/" style="font-size: 10px;">监控系统</a> <a href="/tags/%E8%99%9A%E6%8B%9F%E5%8C%96/" style="font-size: 15.45px;">虚拟化</a> <a href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" style="font-size: 10px;">面试题</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/02/25/go-etcd-clientv3-%E5%8C%85%E5%86%B2%E7%AA%81%E9%97%AE%E9%A2%98/">go-etcd clientv3 包冲突问题</a>
          </li>
        
          <li>
            <a href="/2022/02/16/openstack-%E5%9F%BA%E4%BA%8E%E6%99%BA%E8%83%BD%E7%BD%91%E5%8D%A1%E7%9A%84%E7%83%AD%E8%BF%81%E7%A7%BB%E5%AE%9E%E7%8E%B0/">openstack-基于智能网卡的热迁移实现</a>
          </li>
        
          <li>
            <a href="/2022/02/14/openstack-%E5%9F%BA%E4%BA%8Epacker%E8%87%AA%E5%8A%A8%E5%8C%96build%E9%95%9C%E5%83%8F/">openstack-基于packer自动化build镜像</a>
          </li>
        
          <li>
            <a href="/2022/02/08/openstack-%E5%85%BC%E5%AE%B9%E6%B5%B7%E5%85%89hygon%E6%9C%8D%E5%8A%A1%E5%99%A8/">openstack-兼容海光hygon服务器</a>
          </li>
        
          <li>
            <a href="/2022/01/25/%E8%99%9A%E6%8B%9F%E5%8C%96-OVS-DPDK%E5%9C%A8CentOS7%E4%B8%8A%E7%9A%84%E9%83%A8%E7%BD%B2%E8%B0%83%E8%AF%95/">虚拟化-OVS-DPDK在CentOS7上的部署调试</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 Tonyzhang1989<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>