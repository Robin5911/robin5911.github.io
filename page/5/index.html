<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
<script type="text/javascript">
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?ae11d5a19bdcf766771692d64967eeb1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

  

  
  <title>robin5911 的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="云计算&#x2F;编程语言&#x2F;数据库&#x2F;容器化&#x2F;虚拟化">
<meta property="og:type" content="website">
<meta property="og:title" content="robin5911 的博客">
<meta property="og:url" content="https://blog.kubestack.cn/page/5/index.html">
<meta property="og:site_name" content="robin5911 的博客">
<meta property="og:description" content="云计算&#x2F;编程语言&#x2F;数据库&#x2F;容器化&#x2F;虚拟化">
<meta property="og:locale">
<meta property="article:author" content="robin5911">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="robin5911 的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="https://fonts.lug.ustc.edu.cn/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="google-site-verification" content="XkIGmrbqh5J83cILz5wx9StkgaQzjhGx0UfHTxlma00" />

<meta name="generator" content="Hexo 5.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">robin5911 的博客</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
          <a class="main-nav-link" href="/about">关于</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://blog.kubestack.cn"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-elastic-panic-elastic-Error-all-shards-failed" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/09/13/elastic-panic-elastic-Error-all-shards-failed/" class="article-date">
  <time datetime="2021-09-13T10:03:33.000Z" itemprop="datePublished">2021-09-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/09/13/elastic-panic-elastic-Error-all-shards-failed/">elastic-Error all shards failed</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>第一次尝试使用 elastics的go sdk “github.com/olivere/elastic” ，有go版本的真不错，</p>
<p>不料却报错了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">panic: elastic: Error 400 (Bad Request): all shards failed [type&#x3D;search_phase_execution_exception]</span><br></pre></td></tr></table></figure>

<p>上代码吧</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">	&quot;context&quot;</span><br><span class="line">	&quot;elastic-analysis-go&#x2F;es&quot;</span><br><span class="line">	&quot;fmt&quot;</span><br><span class="line">	&quot;github.com&#x2F;olivere&#x2F;elastic&quot;</span><br><span class="line">)</span><br><span class="line">var (</span><br><span class="line">	IndexName &#x3D; &quot;openstack_error_logs&quot;</span><br><span class="line">)</span><br><span class="line">func main()&#123;</span><br><span class="line">	ctx :&#x3D; context.Background()</span><br><span class="line">	_ &#x3D; es.CreateClient(&quot;http:&#x2F;&#x2F;10.224.144.15:9011&quot;, &quot;USERNAME&quot;, &quot;PASSWORD&quot;)</span><br><span class="line">	&#x2F;&#x2F;create terms agg order by openstack region</span><br><span class="line">	aggs :&#x3D; elastic.NewValueCountAggregation().Field(&quot;programname&quot;)</span><br><span class="line"></span><br><span class="line">	searchResult,err :&#x3D; es.EsClient.Search().</span><br><span class="line">						Index(IndexName).</span><br><span class="line">		Query(elastic.NewMatchAllQuery()). &#x2F;&#x2F; 设置查询条件</span><br><span class="line">		Aggregation(&quot;total&quot;, aggs). &#x2F;&#x2F; 设置聚合条件，并为聚合条件设置一个名字</span><br><span class="line">		Size(0).</span><br><span class="line">		Do(ctx)</span><br><span class="line">	if err !&#x3D; nil &#123;</span><br><span class="line">		panic(err)</span><br><span class="line">	&#125;</span><br><span class="line">	&#x2F;&#x2F; 使用ValueCount函数和前面定义的聚合条件名称，查询结果</span><br><span class="line">	agg, found :&#x3D; searchResult.Aggregations.ValueCount(&quot;total&quot;)</span><br><span class="line">	if found &#123;</span><br><span class="line">		&#x2F;&#x2F; 打印结果，注意：这里使用的是取值运算符</span><br><span class="line">		fmt.Println(*agg.Value)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="原因分析："><a href="#原因分析：" class="headerlink" title="原因分析："></a>原因分析：</h4><p>当使用到Field 精准匹配相关的查询时，所以查询的关键字在es上的类型，必须是keyword而不能是text，比如你的搜索条件是 ”programname”:”neutron”,那么该programname 字段的es类型得是keyword，而不能是text<br>改成使用 elastic.NewValueCountAggregation().Field(“programname.keyword”) 就可以了</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.kubestack.cn/2021/09/13/elastic-panic-elastic-Error-all-shards-failed/" data-id="cktpm4ftt0000os16360udly4" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/elastic/" rel="tag">elastic</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-spdk-基于spdk-vhost-qemu启动虚机" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/09/10/spdk-%E5%9F%BA%E4%BA%8Espdk-vhost-qemu%E5%90%AF%E5%8A%A8%E8%99%9A%E6%9C%BA/" class="article-date">
  <time datetime="2021-09-10T07:40:52.000Z" itemprop="datePublished">2021-09-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/09/10/spdk-%E5%9F%BA%E4%BA%8Espdk-vhost-qemu%E5%90%AF%E5%8A%A8%E8%99%9A%E6%9C%BA/">spdk-基于spdk vhost qemu启动虚机</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>qemu启动虚机，driver使用基于spdk的vhost-user-scsi技术， bdev backend为ceph rbd</p>
<p>创建vhost device (上文创建rbd dev名称为Ceph0)</p>
<h5 id="virtio-blk"><a href="#virtio-blk" class="headerlink" title="virtio-blk"></a>virtio-blk</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#scripts&#x2F;rpc.py vhost_create_blk_controller --cpumask 0x1 vhost.1 Ceph1</span><br><span class="line">#scripts&#x2F;rpc.py bdev_virtio_attach_controller --dev-type blk --trtype user --traddr &#x2F;opt&#x2F;tmp&#x2F;vhost.1 --vq-count 2 --vq-size 512 VirtioBlk1</span><br></pre></td></tr></table></figure>
        
          <p class="article-more-link">
            <a href="/2021/09/10/spdk-%E5%9F%BA%E4%BA%8Espdk-vhost-qemu%E5%90%AF%E5%8A%A8%E8%99%9A%E6%9C%BA/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.kubestack.cn/2021/09/10/spdk-%E5%9F%BA%E4%BA%8Espdk-vhost-qemu%E5%90%AF%E5%8A%A8%E8%99%9A%E6%9C%BA/" data-id="ckte5vgp80001dw165h9ef50n" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spdk/" rel="tag">spdk</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-spdk-基于spdk虚拟机性能测试对比" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/09/10/spdk-%E5%9F%BA%E4%BA%8Espdk%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E5%AF%B9%E6%AF%94/" class="article-date">
  <time datetime="2021-09-10T07:40:52.000Z" itemprop="datePublished">2021-09-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/09/10/spdk-%E5%9F%BA%E4%BA%8Espdk%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E5%AF%B9%E6%AF%94/">spdk-基于spdk vhost qemu启动虚机</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>qemu启动虚机，driver使用基于spdk的vhost-user-scsi技术， bdev backend为ceph rbd</p>
<p>创建vhost device (上文创建rbd dev名称为Ceph0)</p>
<h5 id="virtio-blk"><a href="#virtio-blk" class="headerlink" title="virtio-blk"></a>virtio-blk</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#scripts&#x2F;rpc.py vhost_create_blk_controller --cpumask 0x1 vhost.1 Ceph1</span><br><span class="line">#scripts&#x2F;rpc.py bdev_virtio_attach_controller --dev-type blk --trtype user --traddr &#x2F;opt&#x2F;tmp&#x2F;vhost.1 --vq-count 2 --vq-size 512 VirtioBlk1</span><br></pre></td></tr></table></figure>



<h5 id="virtio-scsi"><a href="#virtio-scsi" class="headerlink" title="virtio-scsi"></a>virtio-scsi</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#scripts&#x2F;rpc.py vhost_create_scsi_controller --cpumask 0x1 vhost.0</span><br><span class="line">#scripts&#x2F;rpc.py vhost_scsi_controller_add_target vhost.0 0 Ceph0</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h5 id="启动虚拟机"><a href="#启动虚拟机" class="headerlink" title="启动虚拟机"></a>启动虚拟机</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">qemu-system-x86_64 \</span><br><span class="line">  --enable-kvm \</span><br><span class="line">  -cpu host -smp 2 \</span><br><span class="line">  -m 1G -object memory-backend-file,id&#x3D;mem0,size&#x3D;1G,mem-path&#x3D;&#x2F;dev&#x2F;hugepages,share&#x3D;on -numa node,memdev&#x3D;mem0 \</span><br><span class="line">  -drive file&#x3D;&#x2F;opt&#x2F;a0c4f799-aecf-4ebd-af51-03b2f2f14c5a.qcow2,if&#x3D;none,id&#x3D;disk \</span><br><span class="line">  -device ide-hd,drive&#x3D;disk,bootindex&#x3D;0 \</span><br><span class="line">  -chardev socket,id&#x3D;spdk_vhost_scsi0,path&#x3D;&#x2F;opt&#x2F;tmp&#x2F;vhost.0 \</span><br><span class="line">  -device vhost-user-scsi-pci,id&#x3D;scsi0,chardev&#x3D;spdk_vhost_scsi0 \</span><br><span class="line">  -vnc 10.224.130.52:3</span><br></pre></td></tr></table></figure>

<h4 id="Troubleshooting"><a href="#Troubleshooting" class="headerlink" title="Troubleshooting"></a>Troubleshooting</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">qemu 使用 4.2.0 </span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.kubestack.cn/2021/09/10/spdk-%E5%9F%BA%E4%BA%8Espdk%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E5%AF%B9%E6%AF%94/" data-id="cktpm2y72000b841636xq17n6" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spdk/" rel="tag">spdk</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-spdk-spdk-bdev-ceph-rbd-块设备操作" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/09/10/spdk-spdk-bdev-ceph-rbd-%E5%9D%97%E8%AE%BE%E5%A4%87%E6%93%8D%E4%BD%9C/" class="article-date">
  <time datetime="2021-09-10T07:39:37.000Z" itemprop="datePublished">2021-09-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/09/10/spdk-spdk-bdev-ceph-rbd-%E5%9D%97%E8%AE%BE%E5%A4%87%E6%93%8D%E4%BD%9C/">spdk-spdk bdev (ceph rbd)块设备操作</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>因虚拟机后端存储使用rbd, 所以下面spdk bdev 基于ceph rbd</p>
<p>导入ceph集群配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#vim &#x2F;etc&#x2F;ceph&#x2F;conf.conf</span><br></pre></td></tr></table></figure>

<p>创建volume</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#rbd create volumes&#x2F;volume-4431ef41-381e-490d-9976-adba14d2c05b --size 102400</span><br><span class="line">#scripts&#x2F;rpc.py bdev_rbd_create volumes volume-4431ef41-381e-490d-9976-adba14d2c05b 512</span><br></pre></td></tr></table></figure>

<p>删除volume</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#rpc.py bdev_rbd_delete Ceph0</span><br></pre></td></tr></table></figure>

<p>resize volume</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#rpc.py bdev_rbd_resize Ceph0 102400</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.kubestack.cn/2021/09/10/spdk-spdk-bdev-ceph-rbd-%E5%9D%97%E8%AE%BE%E5%A4%87%E6%93%8D%E4%BD%9C/" data-id="ckte5vgp60000dw165pn706s8" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spdk/" rel="tag">spdk</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-spdk-spdk安装指南" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/09/09/spdk-spdk%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/" class="article-date">
  <time datetime="2021-09-09T06:04:50.000Z" itemprop="datePublished">2021-09-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/09/09/spdk-spdk%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/">spdk-spdk安装指南</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>基于 CentOS 7 x86_64 安装spdk环境, 需要支持rbd和rdma</p>
<p>环境 : gcc-4.8.5</p>
<ol>
<li>下载源码文件(网络不稳定, git中途失败请重复多次运行)</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#git clone https:&#x2F;&#x2F;github.com&#x2F;spdk&#x2F;spdk</span><br><span class="line">#cd spdk</span><br><span class="line">#git checkout v21.04</span><br><span class="line">#git submodule update --init</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>安装必需环境</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo scripts&#x2F;pkgdep.sh --all</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>构建</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;configure --with-rbd --with-rdma --with-ocf</span><br><span class="line">make</span><br></pre></td></tr></table></figure>

<h4 id="启动vhost-target"><a href="#启动vhost-target" class="headerlink" title="启动vhost target"></a>启动vhost target</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#HUGEMEM&#x3D;4096 scripts&#x2F;setup.sh</span><br><span class="line">#build&#x2F;bin&#x2F;vhost -S &#x2F;var&#x2F;tmp -m 0x3</span><br></pre></td></tr></table></figure>



<h4 id="troubleshooting"><a href="#troubleshooting" class="headerlink" title="troubleshooting"></a>troubleshooting</h4><ol>
<li>已经安装librbd，spdk却不识别librbd</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;configure --with-rbd --with-rdma</span><br><span class="line">Notice: ISA-L, compression &amp; crypto require NASM version 2.14 or newer. Turning off default ISA-L and crypto features.</span><br><span class="line">Using default SPDK env in &#x2F;root&#x2F;spdk&#x2F;lib&#x2F;env_dpdk</span><br><span class="line">Using default DPDK in &#x2F;root&#x2F;spdk&#x2F;dpdk&#x2F;build</span><br><span class="line">Using &#39;verbs&#39; RDMA provider</span><br><span class="line">--with-rbd requires librados and librbd.</span><br><span class="line">Please install then re-run this script.</span><br></pre></td></tr></table></figure>

<p>安装 librbd1-devel</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.kubestack.cn/2021/09/09/spdk-spdk%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/" data-id="cktcrags20000hs162oupfyop" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spdk/" rel="tag">spdk</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-logstash-基于docker部署" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/08/31/logstash-%E5%9F%BA%E4%BA%8Edocker%E9%83%A8%E7%BD%B2/" class="article-date">
  <time datetime="2021-08-31T08:51:59.000Z" itemprop="datePublished">2021-08-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/08/31/logstash-%E5%9F%BA%E4%BA%8Edocker%E9%83%A8%E7%BD%B2/">logstash - 基于docker部署</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>下载docker镜像</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#docker pull docker.elastic.co&#x2F;logstash&#x2F;logstash:7.6.2</span><br></pre></td></tr></table></figure>

<p>创建本地配置目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#mkdir &#x2F;usr&#x2F;local&#x2F;logstash&#x2F;config</span><br></pre></td></tr></table></figure>

<p>配置logstash.yml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#vim &#x2F;usr&#x2F;local&#x2F;logstash&#x2F;config&#x2F;logstash.yml</span><br><span class="line"></span><br><span class="line">config:</span><br><span class="line">  reload:</span><br><span class="line">    automatic: true</span><br><span class="line">    interval: 3s</span><br><span class="line">xpack:</span><br><span class="line">  management.enabled: false</span><br><span class="line">  monitoring.enabled: false</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.kubestack.cn/2021/08/31/logstash-%E5%9F%BA%E4%BA%8Edocker%E9%83%A8%E7%BD%B2/" data-id="cktcrags40001hs16f0zr61l3" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ELK/" rel="tag">ELK</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-openstack硬件加速器管理-Cyborg调研" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/08/30/openstack%E7%A1%AC%E4%BB%B6%E5%8A%A0%E9%80%9F%E5%99%A8%E7%AE%A1%E7%90%86-Cyborg%E8%B0%83%E7%A0%94/" class="article-date">
  <time datetime="2021-08-30T03:38:07.000Z" itemprop="datePublished">2021-08-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/08/30/openstack%E7%A1%AC%E4%BB%B6%E5%8A%A0%E9%80%9F%E5%99%A8%E7%AE%A1%E7%90%86-Cyborg%E8%B0%83%E7%A0%94/">openstack硬件加速器管理 - Cyborg调研</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><p>随着5G、互联网、物联网等技术的发展, 对计算业务进行加速、卸载的需求日渐增多, Cyborg项目由此诞生。</p>
<p>Cyborg(以前叫做Nomad)是OpenStack用于管理硬件和软件加速资源框架, 包括GPU、FPGA、加解密卡, NVMe/NOF SSDs, ODP, DPDK/SPDK等, Cyborg就是OpenStack中的加速即服务(Acceleration as a Service)。该项目在OpenStack Q版本时正式发布, 由华为、联想、红帽主导，是一个很年轻的项目, 目前功能还不是很完善。</p>
<p>Cyborg通过管理、使用计算节点上的加速器硬件, 可以提供电信运营商在NFV以及边缘计算场景下的各种加速服务、提高用户体验、降低CPU负载。运维人员可以通过Cyborg列出、识别和发现加速器，挂载、卸载加速器实例, 安装、卸载驱动。它可以单独使用或与 Nova 或 Ironic 结合使用。</p>
<h4 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h4><p>Cyborg采用经典架构，由cyborg-api、cyborg-conductor、cyborg-agent、 cyborg-db几个模块组成。其中Cyborg-agent位于计算节点，用于监控加速器；cyborg-conductor位于控制节点，管理整个系统和操作数据库。cyborg-api和cyborg-db分别为接口和数据库，均位于控制节点。</p>
<p><img src="/images/cyborg.jpg"></p>
<h4 id="工作流程"><a href="#工作流程" class="headerlink" title="工作流程"></a>工作流程</h4><p>从Cyborg的架构图和API来看, 其主要工作流程如下:</p>
<ol>
<li><p>cyborg-api会接收用户创建加速器的API调用, 通过cyborg-conductor保存到cyborg-db</p>
</li>
<li><p>cyborg-conductor通过rpc调用计算节点上的cyborg-agent, cyborg-agent会调用对应的厂商驱动, 最后由厂商驱动来执行配置计算节点底层的加速资源</p>
</li>
<li><p>计算节点上的cyborg-agent通过定时查询加速资源使用情况, 并通过API发送给placement服务, 该信息最终会给nova在调度时使用。</p>
</li>
</ol>
<p>注: 由于加速设备可能存在多个设备互相关联的层次化结构, 如SRIOV PF和VF之间有关联关系。Nova在O版时, 为resource-providers数据库进行了扩展, 支持了设备的层次化关系。</p>
<p><a target="_blank" rel="noopener" href="http://specs.openstack.org/openstack/nova-specs/specs/ocata/approved/nested-resource-providers.html">http://specs.openstack.org/openstack/nova-specs/specs/ocata/approved/nested-resource-providers.html</a></p>
<ol start="4">
<li>Nova进行调度, 并在虚拟机中挂载虚拟加速设备给用户使用</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.kubestack.cn/2021/08/30/openstack%E7%A1%AC%E4%BB%B6%E5%8A%A0%E9%80%9F%E5%99%A8%E7%AE%A1%E7%90%86-Cyborg%E8%B0%83%E7%A0%94/" data-id="cktcragsp0006hs169s554wna" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openstack/" rel="tag">openstack</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-mysql-查询重复数据" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/08/26/mysql-%E6%9F%A5%E8%AF%A2%E9%87%8D%E5%A4%8D%E6%95%B0%E6%8D%AE/" class="article-date">
  <time datetime="2021-08-26T02:11:05.000Z" itemprop="datePublished">2021-08-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/08/26/mysql-%E6%9F%A5%E8%AF%A2%E9%87%8D%E5%A4%8D%E6%95%B0%E6%8D%AE/">mysql-查询重复数据</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>查询表中重复数据，展示出字段内容和count</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; select user_name,count(*) as count from user group by user_name having count&gt;1;</span><br></pre></td></tr></table></figure>




      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.kubestack.cn/2021/08/26/mysql-%E6%9F%A5%E8%AF%A2%E9%87%8D%E5%A4%8D%E6%95%B0%E6%8D%AE/" data-id="ckssanb3y0001to16fh0m6bol" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-openstack-裸金属ironic源码创建分析" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/05/27/openstack-%E8%A3%B8%E9%87%91%E5%B1%9Eironic%E6%BA%90%E7%A0%81%E5%88%9B%E5%BB%BA%E5%88%86%E6%9E%90/" class="article-date">
  <time datetime="2021-05-27T07:19:26.000Z" itemprop="datePublished">2021-05-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/05/27/openstack-%E8%A3%B8%E9%87%91%E5%B1%9Eironic%E6%BA%90%E7%A0%81%E5%88%9B%E5%BB%BA%E5%88%86%E6%9E%90/">openstack-裸金属ironic源码创建分析</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>openstack ironic 裸金属创建裸机流程源码分析</p>
<p>基于 ironic stein</p>
<p>ironic-api接收到了provision_state的设置请求，然后返回202的异步请求，api请求到了ironic.api.controllers.v1.node.NodeStatesController的provision方法， 然后调用了 _do_provision_action 方法 。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@METRICS.timer(&#39;NodeStatesController.provision&#39;)</span><br><span class="line">@expose.expose(None, types.uuid_or_name, wtypes.text,</span><br><span class="line">               types.jsontype, types.jsontype, wtypes.text,</span><br><span class="line">               status_code&#x3D;http_client.ACCEPTED)</span><br><span class="line">def provision(self, node_ident, target, configdrive&#x3D;None,</span><br><span class="line">              clean_steps&#x3D;None, rescue_password&#x3D;None):</span><br><span class="line">***************</span><br><span class="line">self._do_provision_action(rpc_node, target, configdrive, clean_steps,</span><br><span class="line">                              rescue_password)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">def _do_provision_action(self, rpc_node, target, configdrive&#x3D;None,</span><br><span class="line">                             clean_steps&#x3D;None, rescue_password&#x3D;None):</span><br><span class="line">     ************</span><br><span class="line">     if target in (ir_states.ACTIVE, ir_states.REBUILD):</span><br><span class="line">            rebuild &#x3D; (target &#x3D;&#x3D; ir_states.REBUILD)</span><br><span class="line">            pecan.request.rpcapi.do_node_deploy(context&#x3D;pecan.request.context,</span><br><span class="line">                                                node_id&#x3D;rpc_node.uuid,</span><br><span class="line">                                                rebuild&#x3D;rebuild,</span><br><span class="line">                                                configdrive&#x3D;configdrive,</span><br><span class="line">                                                topic&#x3D;topic)                         </span><br></pre></td></tr></table></figure>

<p>然后RPC调用的ironic.condutor.manager.ConductorManager.do_node_deploy方法, 最终启动一个task ，调用 ironic.condutor.manager.do_node_deploy方法， 如果配置了configdrive会传至swift接口，然后调用 task.driver.deploy.prepare(task) 过程， 不同驱动的动作不一样 pxe_* 驱动使用的是iscsi_deploy.ISCSIDeploy.prepare，本地用的  task.driver.deploy.deploy</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">@METRICS.timer(&#39;ConductorManager.do_node_deploy&#39;)</span><br><span class="line">@messaging.expected_exceptions(exception.NoFreeConductorWorker,</span><br><span class="line">                               exception.NodeLocked,</span><br><span class="line">                               exception.NodeInMaintenance,</span><br><span class="line">                               exception.InstanceDeployFailure,</span><br><span class="line">                               exception.InvalidStateRequested,</span><br><span class="line">                               exception.NodeProtected)</span><br><span class="line">def do_node_deploy(self, context, node_id, rebuild&#x3D;False,</span><br><span class="line">                   configdrive&#x3D;None):</span><br><span class="line">    ********</span><br><span class="line">    #状态相关检查，确保裸机参数及电源正常</span><br><span class="line">     try:</span><br><span class="line">            task.driver.power.validate(task)</span><br><span class="line">            task.driver.deploy.validate(task)</span><br><span class="line">            utils.validate_instance_info_traits(task.node)</span><br><span class="line">            conductor_steps.validate_deploy_templates(task)</span><br><span class="line">        except exception.InvalidParameterValue as e:</span><br><span class="line">            raise exception.InstanceDeployFailure(</span><br><span class="line">                _(&quot;Failed to validate deploy or power info for node &quot;</span><br><span class="line">                  &quot;%(node_uuid)s. Error: %(msg)s&quot;) %</span><br><span class="line">                &#123;&#39;node_uuid&#39;: node.uuid, &#39;msg&#39;: e&#125;, code&#x3D;e.code)</span><br><span class="line"></span><br><span class="line">        LOG.debug(&quot;do_node_deploy Calling event: %(event)s for node: &quot;</span><br><span class="line">                  &quot;%(node)s&quot;, &#123;&#39;event&#39;: event, &#39;node&#39;: node.uuid&#125;)</span><br><span class="line">        try:</span><br><span class="line">            task.process_event(</span><br><span class="line">                event,</span><br><span class="line">                callback&#x3D;self._spawn_worker,</span><br><span class="line">                call_args&#x3D;(do_node_deploy, task, self.conductor.id,</span><br><span class="line">                           configdrive),</span><br><span class="line">                err_handler&#x3D;utils.provisioning_error_handler)</span><br><span class="line">        except exception.InvalidState:</span><br><span class="line">            raise exception.InvalidStateRequested(</span><br><span class="line">                action&#x3D;event, node&#x3D;task.node.uuid,</span><br><span class="line">                state&#x3D;task.node.provision_state)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@METRICS.timer(&#39;do_node_deploy&#39;)</span><br><span class="line">@task_manager.require_exclusive_lock</span><br><span class="line">def do_node_deploy(task, conductor_id&#x3D;None, configdrive&#x3D;None):</span><br><span class="line">    &quot;&quot;&quot;Prepare the environment and deploy a node.&quot;&quot;&quot;</span><br><span class="line">    node &#x3D; task.node</span><br><span class="line"></span><br><span class="line">    try:</span><br><span class="line">        if configdrive:</span><br><span class="line">            if isinstance(configdrive, dict):</span><br><span class="line">                configdrive &#x3D; utils.build_configdrive(node, configdrive)</span><br><span class="line">            _store_configdrive(node, configdrive)</span><br><span class="line">    ******************</span><br><span class="line">    try:</span><br><span class="line">        task.driver.deploy.prepare(task)</span><br></pre></td></tr></table></figure>

<p>如果是iSCSI启动，task.driver.deploy.prepare(task) 调用 iscsi_deploy.py 的 prepare(task),  初次调用 task.driver.boot.prepare_instance(task) ， 配置dhcp ，准备pxe config和缓存镜像， 通过ipmi操控bios配置启动设备</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">*****</span><br><span class="line">pxe_utils.cache_ramdisk_kernel(task, instance_image_info,</span><br><span class="line">                                           ipxe_enabled&#x3D;CONF.pxe.ipxe_enabled)</span><br><span class="line">*****</span><br><span class="line"> pxe_utils.prepare_instance_pxe_config(</span><br><span class="line">                task, instance_image_info,</span><br><span class="line">                iscsi_boot&#x3D;deploy_utils.is_iscsi_boot(task),</span><br><span class="line">                ramdisk_boot&#x3D;(boot_option &#x3D;&#x3D; &quot;ramdisk&quot;),</span><br><span class="line">                ipxe_enabled&#x3D;CONF.pxe.ipxe_enabled)</span><br><span class="line">*****</span><br><span class="line"># If it&#39;s going to PXE boot we need to update the DHCP server</span><br><span class="line">            dhcp_opts &#x3D; pxe_utils.dhcp_options_for_instance(</span><br><span class="line">                task, ipxe_enabled)</span><br><span class="line">            provider &#x3D; dhcp_factory.DHCPFactory()</span><br><span class="line">            provider.update_dhcp(task, dhcp_opts)  </span><br><span class="line">*****</span><br><span class="line"> manager_utils.node_set_boot_device(task, boot_device,</span><br><span class="line">                                               persistent&#x3D;persistent)</span><br></pre></td></tr></table></figure>

<p>默认本地启动调用 ironic.drivers.modules.pxe.PXERamdiskDeploy.prepare中会检查boot_option是否正确,  然后调用 populate_storage_driver_internal_info，如果使用iSCSI启动，保存boot的volume 信息至internal_info , 最终调用 调用 ironic.drivers.modules.pxe.PXEBoot.prepare_instance  启动部署</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@METRICS.timer(&#39;RamdiskDeploy.prepare&#39;)</span><br><span class="line">   @task_manager.require_exclusive_lock</span><br><span class="line">   def prepare(self, task):</span><br><span class="line">   *****</span><br><span class="line">    deploy_utils.populate_storage_driver_internal_info(task)</span><br><span class="line">    ******</span><br><span class="line">    if node.provision_state in (states.ACTIVE, states.UNRESCUING):</span><br><span class="line">           # In the event of takeover or unrescue.</span><br><span class="line">           task.driver.boot.prepare_instance(task)</span><br></pre></td></tr></table></figure>

<p>调用 ironic.drivers.modules.pxe.PXEBoot.prepare_instance，  配置dhcp ，准备pxe config和缓存镜像， 通过ipmi操控bios配置启动设备</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">****</span><br><span class="line">#缓存镜像到本地</span><br><span class="line">pxe_utils.cache_ramdisk_kernel(task, instance_image_info,</span><br><span class="line">                                           ipxe_enabled&#x3D;CONF.pxe.ipxe_enabled)</span><br><span class="line"> ****</span><br><span class="line"> #为当前裸机准备 单独的 pxe 文件</span><br><span class="line"> pxe_utils.prepare_instance_pxe_config(</span><br><span class="line">                task, instance_image_info,</span><br><span class="line">                iscsi_boot&#x3D;deploy_utils.is_iscsi_boot(task),</span><br><span class="line">                ramdisk_boot&#x3D;(boot_option &#x3D;&#x3D; &quot;ramdisk&quot;),</span><br><span class="line">                ipxe_enabled&#x3D;CONF.pxe.ipxe_enabled)</span><br><span class="line">            boot_device &#x3D; boot_devices.PXE</span><br><span class="line">  *****</span><br><span class="line">  #因pxe启动，需update ironic DHCP配置文件配置pxe,bootfile等信息，本地启动时清理pxe文件更改启动设备为磁盘</span><br><span class="line">  # If it&#39;s going to PXE boot we need to update the DHCP server</span><br><span class="line">            dhcp_opts &#x3D; pxe_utils.dhcp_options_for_instance(</span><br><span class="line">                task, ipxe_enabled)</span><br><span class="line">            provider &#x3D; dhcp_factory.DHCPFactory()</span><br><span class="line">            provider.update_dhcp(task, dhcp_opts)</span><br><span class="line">  ****</span><br><span class="line">  #</span><br><span class="line">  manager_utils.node_set_boot_device(task, boot_device,</span><br><span class="line">                                               persistent&#x3D;persistent)</span><br><span class="line">  ****</span><br><span class="line">  #开始部署</span><br><span class="line">  _do_next_deploy_step(task, 0, conductor_id)</span><br></pre></td></tr></table></figure>

<p>调用task.deploy</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">*****</span><br><span class="line">result &#x3D; interface.execute_deploy_step(task, step)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>如果是iSCSI启动直接调用了 iscsi_deploy.ISCSIDeploy.deploy, cinder盘，不需要缓存镜像，所以，关机，切换租户网络，开机</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">*****</span><br><span class="line"> manager_utils.node_power_action(task, states.POWER_OFF)</span><br><span class="line">            power_state_to_restore &#x3D; (</span><br><span class="line">                manager_utils.power_on_node_if_needed(task))</span><br><span class="line">            task.driver.network.remove_provisioning_network(task)</span><br><span class="line">            task.driver.network.configure_tenant_networks(task)</span><br><span class="line">            manager_utils.restore_power_state_if_needed(</span><br><span class="line">                task, power_state_to_restore)</span><br><span class="line">            task.driver.boot.prepare_instance(task)</span><br><span class="line">            manager_utils.node_power_action(task, states.POWER_ON)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>本地盘 调用pxe.PXEBoot.deploy启动deploy会关机，配置租户网络, 再开机</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">*****</span><br><span class="line">manager_utils.node_power_action(task, states.POWER_OFF)</span><br><span class="line">******</span><br><span class="line"> task.driver.network.configure_tenant_networks(task)</span><br><span class="line">*****</span><br><span class="line">manager_utils.node_power_action(task, states.POWER_ON)</span><br></pre></td></tr></table></figure>

<p>至此deploy完，本地盘会进入ramdisk， iSCSI启动不走ramdisk会直接进去系统，</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.kubestack.cn/2021/05/27/openstack-%E8%A3%B8%E9%87%91%E5%B1%9Eironic%E6%BA%90%E7%A0%81%E5%88%9B%E5%BB%BA%E5%88%86%E6%9E%90/" data-id="ckssanb4b000rto16cdlabyql" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openstack/" rel="tag">openstack</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-openstack-裸金属ironic创建及调度-3" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/05/07/openstack-%E8%A3%B8%E9%87%91%E5%B1%9Eironic%E5%88%9B%E5%BB%BA%E5%8F%8A%E8%B0%83%E5%BA%A6-3/" class="article-date">
  <time datetime="2021-05-07T04:04:08.000Z" itemprop="datePublished">2021-05-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/05/07/openstack-%E8%A3%B8%E9%87%91%E5%B1%9Eironic%E5%88%9B%E5%BB%BA%E5%8F%8A%E8%B0%83%E5%BA%A6-3/">openstack-裸金属ironic创建及调度-3</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="云盘支持"><a href="#云盘支持" class="headerlink" title="云盘支持"></a>云盘支持</h2><p>When user starts bare metal instance with Cinder volume, Nova orchestrates the communication with Cinder and Ironic. The work flow of the boot process is as follows:</p>
<ol>
<li>(Preparation) Administrator registers a node with initiator information.</li>
<li>User asks Cinder to create a boot volume.</li>
<li>User asks Nova to boot a node from the Cinder volume.</li>
<li>Nova calls Ironic to collect iSCSI/FC initiator information. Ironic collects initiator information and returns it to Nova.</li>
<li>Nova calls Cinder to attach the volume to the node. Cinder attaches the volume to the node and returns connection information which includes target information.</li>
<li>Nova passes the target information for the node to Ironic</li>
<li>Nova calls Ironic to spawn the instance. Ironic prepares the bare metal node to boot from the remote volume which is identified by target information and powers on the bare metal node.</li>
</ol>
<p>In the work flow above, Nova calls Ironic to get/set initiator/target information (4 and 6) and also administrator calls Ironic to set initiator information (1) but currently Ironic has neither those information nor APIs for them.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#pip install rbd-iscsi-client&#x3D;&#x3D;0.1.8 -i https:&#x2F;&#x2F;pypi.tuna.tsinghua.edu.cn&#x2F;simple</span><br><span class="line">#cinder type-create rbd_iscsi</span><br><span class="line">#cinder type-key rbd_iscsi set volume_backend_name&#x3D;rbd_iscsi</span><br><span class="line">#cinder create 100 --display-name iscsi_boot1 --volume-type rbd_iscsi --image-id 3ec7c300-78bc-4d4b-bb1d-aaab4b4c35d7</span><br><span class="line">#cinder create 100 --display-name iscsi_boot2 --volume-type rbd_iscsi</span><br><span class="line">#openstack baremetal node set --storage-interface cinder 5e10c067-c0c6-48be-ac6e-749a70045b97</span><br><span class="line">#openstack baremetal node set --property capabilities&#x3D;iscsi_boot:True 5e10c067-c0c6-48be-ac6e-749a70045b97</span><br><span class="line"></span><br><span class="line">这一步可以理解为注册主机，target中host信息，id名称随便起，最大64bytes</span><br><span class="line">#openstack baremetal volume connector create --node 5e10c067-c0c6-48be-ac6e-749a70045b97 --type iqn --connector-id iqn.2021-04.net.*****.sh.cluster.5e10c067-c0c6-48be-ac6e-749a70045b97</span><br><span class="line">为该裸机分配磁盘 volume</span><br><span class="line">#openstack baremetal volume target create --node 5e10c067-c0c6-48be-ac6e-749a70045b97 --type iscsi --boot-index 0 --volume cfa8c986-7a79-48fd-88a0-aa997d579fbf --property auth_method&#x3D;&quot;CHAP&quot; --property auth_username&#x3D;&quot;admin&quot; --property auth_password&#x3D;&quot;admin&quot;</span><br><span class="line">#openstack baremetal volume target create --node 5e10c067-c0c6-48be-ac6e-749a70045b97 --type iscsi --boot-index 1 --volume 4e4e41e3-fbfb-4737-bd93-863f48470244 --property auth_method&#x3D;&quot;CHAP&quot; --property auth_username&#x3D;&quot;admin&quot; --property auth_password&#x3D;&quot;admin&quot;</span><br><span class="line"></span><br><span class="line">#openstack server create --image 3ec7c300-78bc-4d4b-bb1d-aaab4b4c35d7 --flavor bms.large --nic net-id&#x3D;cb1356ca-e79b-4d7b-ad29-3267e4c2bc41 bm01</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#cinder create 100 --display-name centos7-grub2-iscsi-pwd  --image-id ea4266e4-456e-4fe0-91c9-a8c15dd2d2d6 --volume-type rbd_iscsi</span><br><span class="line">#gwcli</span><br><span class="line">&gt;cd &#x2F;disks&#x2F;</span><br><span class="line">&gt;create iscsi-data image&#x3D;volume-98ebbe5c-a32f-45ee-be04-61c295bcabe4 size&#x3D;100g</span><br><span class="line">&gt;goto hosts</span><br><span class="line">&gt;create iqn.2021-01.net.*****.sh***:server01</span><br><span class="line">&gt;disk add iscsi-data&#x2F;volume-98ebbe5c-a32f-45ee-be04-61c295bcabe4 size&#x3D;100g</span><br></pre></td></tr></table></figure>



<p>常见问题：</p>
<ol>
<li>volume状态是否是available</li>
<li></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#cat &#x2F;data&#x2F;docker&#x2F;volumes&#x2F;ironic_ipxe&#x2F;_data&#x2F;78\:ac\:44\:04\:f1\:a9.conf </span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">#!ipxe</span><br><span class="line"></span><br><span class="line">set attempts:int32 10</span><br><span class="line">set i:int32 0</span><br><span class="line"></span><br><span class="line">goto deploy</span><br><span class="line"></span><br><span class="line">:deploy</span><br><span class="line">imgfree</span><br><span class="line">kernel  selinux&#x3D;0 troubleshoot&#x3D;0 text nofb nomodeset vga&#x3D;normal console&#x3D;tty0 console&#x3D;ttyS0,115200n8 ipa-debug&#x3D;1 BOOTIF&#x3D;$&#123;mac&#125; ipa-api-url&#x3D;http:&#x2F;&#x2F;10.218.105.100:6385 initrd&#x3D;deploy_ramdisk coreos.configdrive&#x3D;0 || goto retry</span><br><span class="line"></span><br><span class="line">initrd  || goto retry</span><br><span class="line">boot</span><br><span class="line"></span><br><span class="line">:retry</span><br><span class="line">iseq $&#123;i&#125; $&#123;attempts&#125; &amp;&amp; goto fail ||</span><br><span class="line">inc i</span><br><span class="line">echo No response, retrying in &#123;i&#125; seconds.</span><br><span class="line">sleep $&#123;i&#125;</span><br><span class="line">goto deploy</span><br><span class="line"></span><br><span class="line">:fail</span><br><span class="line">echo Failed to get a response after $&#123;attempts&#125; attempts</span><br><span class="line">echo Powering off in 30 seconds.</span><br><span class="line">sleep 30</span><br><span class="line">poweroff</span><br><span class="line"></span><br><span class="line">:boot_partition</span><br><span class="line">imgfree</span><br><span class="line">kernel no_kernel root&#x3D;&#123;&#123; ROOT &#125;&#125; ro text nofb nomodeset vga&#x3D;normal console&#x3D;tty0 console&#x3D;ttyS0,115200n8 ipa-debug&#x3D;1 initrd&#x3D;ramdisk || goto boot_partition</span><br><span class="line">initrd no_ramdisk || goto boot_partition</span><br><span class="line">boot</span><br><span class="line"></span><br><span class="line">:boot_ramdisk</span><br><span class="line">imgfree</span><br><span class="line">kernel no_kernel root&#x3D;&#x2F;dev&#x2F;ram0 text nofb nomodeset vga&#x3D;normal console&#x3D;tty0 console&#x3D;ttyS0,115200n8 ipa-debug&#x3D;1  initrd&#x3D;ramdisk || goto boot_ramdisk</span><br><span class="line">initrd no_ramdisk || goto boot_ramdisk</span><br><span class="line">boot</span><br><span class="line"></span><br><span class="line">:boot_iscsi</span><br><span class="line">imgfree</span><br><span class="line">set username iqn.2021-04.net.*****.5e10c067-c0c6-48be-ac6e-749a70045b97</span><br><span class="line">set password Cc6BK5uTbCsH6hCF</span><br><span class="line">set initiator-iqn iqn.2021-04.net.*****.5e10c067-c0c6-48be-ac6e-749a70045b97</span><br><span class="line">sanhook --drive 0x80 iscsi:10.206.79.34::3260:1:iqn.2021-04.net.*****.iscsi-gw:ceph-igw || goto fail_iscsi_retry</span><br><span class="line">set username admin</span><br><span class="line">set password admin</span><br><span class="line">sanhook --drive 0x81 iscsi::::: || goto fail_iscsi_retry</span><br><span class="line">set username iqn.2021-04.net.*****.5e10c067-c0c6-48be-ac6e-749a70045b97</span><br><span class="line">set password Cc6BK5uTbCsH6hCF</span><br><span class="line">sanboot --no-describe || goto fail_iscsi_retry</span><br><span class="line"></span><br><span class="line">:fail_iscsi_retry</span><br><span class="line">echo Failed to attach iSCSI volume(s), retrying in 10 seconds.</span><br><span class="line">sleep 10</span><br><span class="line">goto boot_iscsi</span><br><span class="line"></span><br><span class="line">:boot_whole_disk</span><br></pre></td></tr></table></figure>





<p>bs=16k, iodepth=1</p>
<p>吞吐</p>
<table>
<thead>
<tr>
<th></th>
<th>顺序读</th>
<th>顺序写</th>
<th>随机读</th>
<th>随机写</th>
<th>混合随机读写</th>
</tr>
</thead>
<tbody><tr>
<td>数据云盘sata</td>
<td>246MB</td>
<td>41.8MB</td>
<td>291MB</td>
<td>10.1MB</td>
<td>7799kB/7894kB</td>
</tr>
<tr>
<td>物理盘(sas*2 raid1)</td>
<td>584MB</td>
<td>1418MB/s</td>
<td>127MB</td>
<td>65.4MB</td>
<td>40.2MB/40.1MB</td>
</tr>
</tbody></table>
<p>IOPS</p>
<table>
<thead>
<tr>
<th></th>
<th>顺序读</th>
<th>顺序写</th>
<th>随机读</th>
<th>随机写</th>
<th>混合随机读写</th>
</tr>
</thead>
<tbody><tr>
<td>数据云盘sata</td>
<td>15.0k</td>
<td>2550</td>
<td>17.8k</td>
<td>618</td>
<td>476/481</td>
</tr>
<tr>
<td>物理盘(sas*2 raid1)</td>
<td>35.7k</td>
<td>86.6k</td>
<td>7747</td>
<td>3990</td>
<td>2451/2450</td>
</tr>
</tbody></table>
<p>bs=4k,iodepth=1</p>
<p>吞吐</p>
<table>
<thead>
<tr>
<th></th>
<th>顺序读</th>
<th>顺序写</th>
<th>随机读</th>
<th>随机写</th>
<th>混合随机读写</th>
</tr>
</thead>
<tbody><tr>
<td>数据云盘sata</td>
<td>112MB</td>
<td>14.1MB</td>
<td>93.1MB</td>
<td>2490kB</td>
<td>2212kB/2238kB</td>
</tr>
<tr>
<td>物理盘(sas*2 raid1)</td>
<td>367MB</td>
<td>372MB</td>
<td>21.4MB</td>
<td>15.0MB</td>
<td>7252kB/7263kB</td>
</tr>
</tbody></table>
<p>IOPS</p>
<table>
<thead>
<tr>
<th></th>
<th>顺序读</th>
<th>顺序写</th>
<th>随机读</th>
<th>随机写</th>
<th>混合随机读写</th>
</tr>
</thead>
<tbody><tr>
<td>数据云盘sata</td>
<td>27.3k</td>
<td>3431</td>
<td>22.7k</td>
<td>607</td>
<td>559/565</td>
</tr>
<tr>
<td>物理盘(sas*2 raid1)</td>
<td>89.5k</td>
<td>90.8k</td>
<td>5223</td>
<td>3904</td>
<td>1770/1773</td>
</tr>
</tbody></table>
<p>吞吐 bs=1024k,iodepth=128,size=50G,ioengine=psync </p>
<table>
<thead>
<tr>
<th></th>
<th>顺序读</th>
<th>顺序写</th>
<th>随机读</th>
<th>随机写</th>
<th>混合随机读写</th>
</tr>
</thead>
<tbody><tr>
<td>iSCSI云盘sata 600G</td>
<td>840MB</td>
<td>85MB</td>
<td>830MB</td>
<td>140MB</td>
<td>135MB/140MB</td>
</tr>
<tr>
<td>iSCSI云盘sata 4T</td>
<td>840MB</td>
<td>97MB</td>
<td>870MB</td>
<td>140MB</td>
<td>135MB/140MB</td>
</tr>
<tr>
<td>物理盘(sas*2 raid1) 600G</td>
<td>520MB</td>
<td>2650MB</td>
<td>290MB</td>
<td>150MB</td>
<td>95MB/95MB</td>
</tr>
<tr>
<td>物理盘(sata*1 raid0) 4T</td>
<td>340MB</td>
<td>140MB</td>
<td>100MB</td>
<td>120MB</td>
<td>55MB/60MB</td>
</tr>
<tr>
<td>物理盘(ssd*1 raid0) 800G</td>
<td>280MB</td>
<td>230MB</td>
<td>420MB</td>
<td>350MB</td>
<td>175MB/180MB</td>
</tr>
</tbody></table>
<p>IOPS bs=4k,iodepth=128,size=50G,ioengine=psync</p>
<table>
<thead>
<tr>
<th></th>
<th>顺序读</th>
<th>顺序写</th>
<th>随机读</th>
<th>随机写</th>
<th>混合随机读写</th>
</tr>
</thead>
<tbody><tr>
<td>iSCSI云盘sata 600G</td>
<td>25.9k</td>
<td>2663</td>
<td>20k</td>
<td>799</td>
<td>602/609</td>
</tr>
<tr>
<td>iSCSI云盘sata 4T</td>
<td>26k</td>
<td>3167</td>
<td>25k</td>
<td>828</td>
<td>600/600</td>
</tr>
<tr>
<td>物理盘(sas*2 raid1) 600G</td>
<td>82.0k</td>
<td>92.3k</td>
<td>901</td>
<td>1232</td>
<td>685/694</td>
</tr>
<tr>
<td>物理盘(sata*1 raid0) 4T</td>
<td>5.8k</td>
<td>7k</td>
<td>327</td>
<td>276</td>
<td>142/148</td>
</tr>
<tr>
<td>物理盘(ssd*1 raid0) 800G</td>
<td>47.9k</td>
<td>6k</td>
<td>46.4k</td>
<td>39.6k</td>
<td>20.2k/20.2k</td>
</tr>
</tbody></table>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://blog.kubestack.cn/2021/05/07/openstack-%E8%A3%B8%E9%87%91%E5%B1%9Eironic%E5%88%9B%E5%BB%BA%E5%8F%8A%E8%B0%83%E5%BA%A6-3/" data-id="ckssanb430009to16hmlb36nd" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openstack/" rel="tag">openstack</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/4/">&amp;laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><a class="extend next" rel="next" href="/page/6/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ELK/" rel="tag">ELK</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/django/" rel="tag">django</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/elastic/" rel="tag">elastic</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/etcd/" rel="tag">etcd</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go/" rel="tag">go</a><span class="tag-list-count">18</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grpc/" rel="tag">grpc</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iptables/" rel="tag">iptables</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kata/" rel="tag">kata</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kube-ovn/" rel="tag">kube-ovn</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kubernetes/" rel="tag">kubernetes</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mariadb/" rel="tag">mariadb</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/" rel="tag">mysql</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/openstack/" rel="tag">openstack</a><span class="tag-list-count">37</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spdk/" rel="tag">spdk</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/" rel="tag">云计算</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%85%B3%E4%BA%8E%E4%BD%9C%E8%80%85/" rel="tag">关于作者</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" rel="tag">大数据</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" rel="tag">微服务</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E5%AD%A6%E7%94%9F%E6%B4%BB/" rel="tag">文学生活</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BC%8F%E6%B4%9E%E5%AE%89%E5%85%A8/" rel="tag">漏洞安全</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F/" rel="tag">监控系统</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%99%9A%E6%8B%9F%E5%8C%96/" rel="tag">虚拟化</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" rel="tag">面试题</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/ELK/" style="font-size: 10px;">ELK</a> <a href="/tags/Linux/" style="font-size: 17.27px;">Linux</a> <a href="/tags/django/" style="font-size: 10px;">django</a> <a href="/tags/docker/" style="font-size: 13.64px;">docker</a> <a href="/tags/elastic/" style="font-size: 10px;">elastic</a> <a href="/tags/etcd/" style="font-size: 10px;">etcd</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/go/" style="font-size: 19.09px;">go</a> <a href="/tags/grpc/" style="font-size: 10.91px;">grpc</a> <a href="/tags/iptables/" style="font-size: 10px;">iptables</a> <a href="/tags/kata/" style="font-size: 14.55px;">kata</a> <a href="/tags/kube-ovn/" style="font-size: 10px;">kube-ovn</a> <a href="/tags/kubernetes/" style="font-size: 18.18px;">kubernetes</a> <a href="/tags/linux/" style="font-size: 16.36px;">linux</a> <a href="/tags/mariadb/" style="font-size: 10px;">mariadb</a> <a href="/tags/mysql/" style="font-size: 13.64px;">mysql</a> <a href="/tags/openstack/" style="font-size: 20px;">openstack</a> <a href="/tags/python/" style="font-size: 11.82px;">python</a> <a href="/tags/spdk/" style="font-size: 12.73px;">spdk</a> <a href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/" style="font-size: 10px;">云计算</a> <a href="/tags/%E5%85%B3%E4%BA%8E%E4%BD%9C%E8%80%85/" style="font-size: 10px;">关于作者</a> <a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" style="font-size: 10px;">大数据</a> <a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" style="font-size: 10px;">微服务</a> <a href="/tags/%E6%96%87%E5%AD%A6%E7%94%9F%E6%B4%BB/" style="font-size: 10px;">文学生活</a> <a href="/tags/%E6%BC%8F%E6%B4%9E%E5%AE%89%E5%85%A8/" style="font-size: 10px;">漏洞安全</a> <a href="/tags/%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F/" style="font-size: 10px;">监控系统</a> <a href="/tags/%E8%99%9A%E6%8B%9F%E5%8C%96/" style="font-size: 15.45px;">虚拟化</a> <a href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" style="font-size: 10px;">面试题</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a><span class="archive-list-count">17</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a><span class="archive-list-count">16</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a><span class="archive-list-count">19</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/08/15/openstack-%E8%AE%B0%E4%B8%80%E6%AC%A1%E8%99%9A%E6%9C%BA%E5%88%9B%E5%BB%BA%E5%A4%B1%E8%B4%A5%E9%97%AE%E9%A2%98/">openstack-记一次虚机创建失败问题</a>
          </li>
        
          <li>
            <a href="/2022/08/03/openstack-neutron-%E5%B8%B8%E7%94%A8%E7%BD%91%E7%BB%9C%E5%91%BD%E4%BB%A4/">openstack-neutron-常用网络命令</a>
          </li>
        
          <li>
            <a href="/2022/08/01/openstack-nova%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%83%AD%E8%BF%81%E7%A7%BB%E6%BA%90%E7%A0%81%E5%88%A8%E6%9E%90/">openstack-nova-虚拟机热迁移过程源码刨析</a>
          </li>
        
          <li>
            <a href="/2022/07/28/%E8%99%9A%E6%8B%9F%E5%8C%96-numa%E6%9E%B6%E6%9E%84%E8%AE%B2%E8%A7%A3-1/">虚拟化-numa架构讲解(1)</a>
          </li>
        
          <li>
            <a href="/2022/07/27/go-%E5%AE%9E%E7%94%A8%E6%96%B9%E6%B3%95-%E5%88%A4%E6%96%AD%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%BAuuid%E7%B1%BB%E5%9E%8B/">go-实用方法-判断字符串为uuid类型</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer" style="text-align:center;color:white;" >
    <div id="footer-info" class="inner">
      <!--2022 robin5911<br>-->
       <a href="https://beian.miit.gov.cn/" target="_blank">京ICP备2020043539号-1</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
    <a href="/about" class="mobile-nav-link">关于</a>
  
</nav>
    

<script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>